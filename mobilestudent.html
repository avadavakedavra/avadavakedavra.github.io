<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sehr Academy — Student Profile (Fidha)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700;800;900&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  <meta name="theme-color" content="#8BC53F">
  <style>
    :root{
      --sehr-green:#8BC53F;
      --ink:#0F172A;
      --muted:#5b6475;
      --panel: rgba(255,255,255,0.75);
      --panel-strong: rgba(255,255,255,0.92);
      --glass-border: rgba(255,255,255,0.55);
      --shadow: 0 10px 30px rgba(15,23,42,.10);
      --radius: 18px;
      /* gradient palette */
      --darkred1:#b91c1c; --darkred2:#ef4444;   /* 0–30 */
      --red1:#ef4444;     --red2:#f87171;       /* 30–50 */
      --or1:#f59e0b;      --or2:#fbbf24;        /* 50–75 */
      --gld1:#f1ce58;     --gld2:#d4af37;       /* 75–100 */
      --shine1:#fff3b0;   --shine2:#d4af37;
      --frost:#ffffffcc;
      --blur:10px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Nunito, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(139,197,63,.18), transparent 60%),
        radial-gradient(900px 400px at 110% 10%, rgba(139,197,63,.12), transparent 60%),
        #edf3e7;
      position:relative;
      overflow-x:hidden;
    }
    /* subtle noise overlay */
    body:after{
      content:""; position:fixed; inset:0; pointer-events:none; z-index:0;
      background-image:url('data:image/svg+xml;utf8,\
      <svg xmlns="http://www.w3.org/2000/svg" width="140" height="140" viewBox="0 0 140 140">\
        <filter id="n">\
          <feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="2" stitchTiles="stitch"/>\
          <feColorMatrix type="saturate" values="0"/>\
          <feComponentTransfer><feFuncA type="table" tableValues="0 0 .02 .06 .12 .08 .04 0"/></feComponentTransfer>\
        </filter>\
        <rect width="100%" height="100%" filter="url(%23n)"/>\
      </svg>'); opacity:.6; mix-blend-mode:multiply;
    }
    body:before{
      content:""; position:fixed; inset:0;
      background-image: url('data:image/svg+xml;utf8,\
      <svg xmlns="http://www.w3.org/2000/svg" width="800" height="600" viewBox="0 0 800 600" opacity="0.06">\
        <g fill="%230F172A">\
          <text x="40" y="80" font-size="56" font-family="Montserrat">E=mc^2</text>\
          <text x="520" y="140" font-size="42" font-family="Montserrat">f(x)</text>\
          <text x="220" y="210" font-size="48" font-family="Montserrat">Σ</text>\
          <text x="660" y="260" font-size="46" font-family="Montserrat">π</text>\
          <text x="120" y="340" font-size="40" font-family="Montserrat">∫</text>\
          <text x="360" y="440" font-size="52" font-family="Montserrat">Δ</text>\
          <text x="80" y="520" font-size="44" font-family="Montserrat">√x</text>\
        </g>\
      </svg>');
      background-size: 800px 600px; background-repeat: repeat; pointer-events:none; z-index:0;
    }

    /* ===== LOCK SCREEN styles ===== */
    body.locked .wrap{ filter: blur(12px); pointer-events:none; user-select:none; }
    .lock-overlay{ position: fixed; inset: 0; display: grid; place-items: center;
      background: radial-gradient(1200px 800px at 50% -10%, rgba(139,197,63,.15), transparent 60%), rgba(237,243,231,.7);
      backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); z-index: 9999; transition: opacity .35s ease; }
    .lock-card{ width: min(520px, calc(100% - 32px)); background: rgba(255,255,255,.92); border: 1px solid var(--glass-border); border-radius: 20px; box-shadow: 0 20px 60px rgba(15,23,42,.18); padding: 24px; animation: float-in .5s ease both; }
    .lock-head{ display:flex; align-items:center; gap:12px; margin-bottom:12px; font-family: Montserrat; font-weight:900; font-size:22px; }
    .lock-sub{ color: var(--muted); margin-bottom:18px; font-weight:700; }
    .lock-form{ display:grid; gap:10px; grid-template-columns: 1fr auto; }
    .lock-input{ appearance:none; border:1px solid var(--glass-border); background: rgba(255,255,255,.85); border-radius:12px; padding:12px 14px; font-family: Montserrat; font-weight:700; font-size:14px; outline:none; }
    .lock-btn{ appearance:none; border:1px solid var(--glass-border); background: rgba(139,197,63,.95); color:#0f172a; border-radius:12px; padding:12px 16px; font-family: Montserrat; font-weight:900; font-size:14px; cursor:pointer; box-shadow: 0 6px 16px rgba(15,23,42,.12), inset 0 -1px 0 rgba(0,0,0,.05); }
    .lock-btn:hover{ transform: translateY(-1px); }
    .lock-err{ color:#b91c1c; font-weight:800; margin-top:6px; min-height:18px; }
    .lock-foot{ margin-top:10px; font-size:12px; color:#6b7280; }

    /* ===== PAGE styles ===== */
    .wrap{position:relative; z-index:1; padding:24px 14px 100px; max-width:1100px; margin:auto;}
    header{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:16px; position:sticky; top:0; z-index:5; padding:8px 6px; backdrop-filter: blur(var(--blur)); -webkit-backdrop-filter: blur(var(--blur)); background: linear-gradient(to bottom, rgba(255,255,255,.85), rgba(255,255,255,.45)); border-bottom:1px solid rgba(255,255,255,.5); border-radius: 0 0 14px 14px; }
    .logo{ font-family: Montserrat, sans-serif; font-weight:900; letter-spacing:.5px; display:flex; align-items:center; gap:8px; font-size:22px; text-decoration:none; color:var(--ink); }
    .logo .brand b{color:var(--sehr-green);} .title-block h1{ font-family: Montserrat; font-weight:800; margin:0; font-size:18px; letter-spacing:.2px; cursor:pointer; }
    .actions{ display:flex; gap:6px; }
    .btn{ appearance:none; border:1px solid var(--glass-border); background: rgba(255,255,255,.85); border-radius:12px; padding:8px 10px; font-family: Montserrat; font-weight:800; font-size:12px; box-shadow: 0 6px 16px rgba(15,23,42,.08), inset 0 -1px 0 rgba(0,0,0,.05); cursor:pointer; }
    .btn:hover{ transform: translateY(-1px); }

    .card{ background: var(--panel); border:1px solid var(--glass-border); backdrop-filter: blur(var(--blur)); -webkit-backdrop-filter: blur(var(--blur)); border-radius: var(--radius); box-shadow: var(--shadow); animation: pop .5s ease both; }
    .profile{ display:grid; grid-template-columns: 80px 1fr; gap:14px; padding:14px; align-items:center; }
    .avatar{ width:74px; height:74px; border-radius:14px; overflow:hidden; border:2px solid rgba(0,0,0,0.05); box-shadow: inset 0 0 0 1px rgba(255,255,255,0.6); background:#fff; }
    .avatar img{width:100%; height:100%; object-fit:cover; display:block;}
    .info{display:grid; grid-template-columns: 1fr 1fr; gap:10px; align-items:center;}
    .k{ background: var(--panel-strong); border:1px solid var(--glass-border); border-radius: 12px; padding:10px 12px; }
    .k small{display:block; color:var(--muted); font-weight:700; font-size:11px; letter-spacing:.2px; text-transform:uppercase}
    .k b{display:block; font-family: Montserrat; font-size:14px; margin-top:3px}

    .section{ margin-top:16px; padding:12px 14px; }
    .section h2{ margin:0 0 8px; font-family: Montserrat; font-weight:800; font-size:18px; display:flex; align-items:center; gap:8px; }

    /* Subject averages — frosted boxes with watermark icons */
    .avg-grid{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin:10px 0 6px; }
    .avg-card{ position:relative; display:grid; grid-template-rows: auto auto; gap:8px; padding:12px; border-radius:14px; background: rgba(255,255,255,0.86); border:1px solid var(--glass-border); box-shadow: 0 10px 25px rgba(15,23,42,.08), inset 0 1px 0 rgba(255,255,255,.6); }
    .avg-top{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .avg-card .s{font-family: Montserrat; font-weight:800; font-size:13px; letter-spacing:.2px}
    .avg-card .v{font-family: Montserrat; font-weight:900; font-size:18px}
    .mini-bar{ position:relative; height:10px; border-radius:999px; background: rgba(15,23,42,.08); overflow:hidden; }
    .mini-bar > i{ position:absolute; inset:0; width:0%; border-radius:inherit; transition: width 1.1s cubic-bezier(.22,1,.36,1); }
    .passchip{ position:absolute; bottom:8px; right:8px; font-size:10px; font-family: Montserrat; font-weight:800; padding:4px 8px; border-radius:999px; background:#fff; border:1px solid var(--glass-border); }
    .wm{ position:absolute; right:6px; top:-4px; font-family: Montserrat; font-weight:900; font-size:46px; opacity:.08; pointer-events:none; }

    /* Results (Accordions) */
    details.term{ background: var(--panel); border:1px solid var(--glass-border); border-radius:16px; margin-top:10px; overflow:hidden; }
    details.term summary{ list-style:none; cursor:pointer; padding:14px; font-weight:800; font-family: Montserrat; display:flex; align-items:center; justify-content:space-between; gap:10px; }
    details.term summary::-webkit-details-marker{display:none}
    .chip{ background:#fff; border:1px solid var(--glass-border); padding:6px 12px; border-radius:999px; font-weight:900; font-size:12px; box-shadow: inset 0 -1px 0 rgba(0,0,0,.05); }

    .term-body{ padding:8px 12px 14px; background: rgba(255,255,255,0.6); border-top:1px dashed rgba(15,23,42,.08); }

    .exam-row{ display:grid; grid-template-columns: 68px 1fr auto; align-items:center; gap:10px; padding:10px 6px; }
    .label{ font-weight:800; font-family: Montserrat; letter-spacing:.3px; color:#2d3748; background: #fff; border:1px solid var(--glass-border); border-radius:10px; padding:7px 8px; text-align:center; box-shadow: inset 0 -1px 0 rgba(0,0,0,.04); }
    .bar{ position:relative; height:12px; border-radius:999px; background: rgba(15,23,42,.07); overflow:hidden; }
    .bar > i{ position:absolute; inset:0; width:0%; border-radius:inherit; transition: width 1.1s cubic-bezier(.22,1,.36,1); }
    .pct{font-weight:800; font-family: Montserrat; text-align:right; min-width:56px; }
    .pct input{ width:64px; border:1px solid var(--glass-border); background:#fff; border-radius:8px; padding:6px 8px; font: inherit; font-weight:900; text-align:center; }

    /* Totals */
    .total-row{ margin-top:6px; padding:12px 6px 6px; border-top:1px dashed rgba(15,23,42,.12); }
    .total-row h3{ margin:0 0 6px; font-family: Montserrat; font-weight:900; font-size:16px; letter-spacing:.3px; display:flex; align-items:center; gap:8px; }

    /* Metric mini-cards */
    .more-metrics{ display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; margin-top:8px; }
    .metric{ background: rgba(255,255,255,.9); border:1px solid var(--glass-border); border-radius:12px; padding:10px 12px; backdrop-filter: blur(8px); box-shadow: 0 8px 20px rgba(15,23,42,.06); text-align:center; }
    .metric small{ display:block; font-family: Montserrat; font-weight:800; letter-spacing:.2px; color:var(--muted); }
    .metric b{ display:block; font-family: Montserrat; font-weight:900; font-size:16px; margin-top:4px; }

    /* Subject tiles for external exams — percentage bars */
    .tiles-wrap{ margin-top:10px; }
    .tiles-title{ font-family: Montserrat; font-weight:800; font-size:14px; margin:8px 2px 6px; color:#111827; }
    .exam-cards{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    .exam-card{ position:relative; overflow:hidden; backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); padding:12px; border-radius:14px; background: rgba(255,255,255,.86); border:1px solid var(--glass-border); box-shadow: 0 10px 25px rgba(15,23,42,.08), inset 0 1px 0 rgba(255,255,255,.6); }
    .tile-bar{ position:relative; height:14px; border-radius:999px; background:#ffffff; border:1px solid var(--glass-border); box-shadow: inset 0 -1px 0 rgba(0,0,0,.04); overflow:hidden; }
    .tile-bar > i{ position:absolute; inset:0; width:0%; border-radius:inherit; transition: width 1.1s cubic-bezier(.22,1,.36,1); }
    .tile-meta{ display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
    .tile-meta .ptext{ font-family: Montserrat; font-weight:900; font-size:14px; }
    .tile-input{ width:70px; border:1px solid var(--glass-border); background:#fff; border-radius:8px; padding:6px 8px; font: inherit; font-weight:900; text-align:center; }

    /* Tooltip */
    .tooltip{ position: fixed; z-index: 50; pointer-events:none; background: rgba(17,24,39,.85); color: #fff; padding:6px 8px; border-radius:8px; font-family: Montserrat; font-weight:700; font-size:12px; letter-spacing:.2px; transform: translate(-50%, -140%); white-space:nowrap; opacity:0; transition: opacity .15s ease; }

    /* Footer */
    .foot{ margin-top:22px; text-align:right; color:#6b7280; font-size:12px; }

    /* Floating edit action bar (mobile-first) */
    .fab{ position:fixed; right:14px; bottom:88px; z-index:6; }
    .fab button{ border:none; border-radius:999px; padding:14px 16px; background:linear-gradient(135deg, #fff, rgba(255,255,255,.6)); border:1px solid var(--glass-border); box-shadow: 0 10px 30px rgba(15,23,42,.18); font-family: Montserrat; font-weight:900; cursor:pointer; }
    .actionbar{ position:fixed; left:0; right:0; bottom:0; z-index:6; display:flex; gap:8px; padding:10px; backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); background: linear-gradient(to top, rgba(255,255,255,.9), rgba(255,255,255,.6)); border-top:1px solid var(--glass-border); }
    .actionbar .ab-btn{ flex:1; border:1px solid var(--glass-border); background:#fff; border-radius:12px; padding:12px; font-family: Montserrat; font-weight:900; cursor:pointer; box-shadow: 0 6px 16px rgba(15,23,42,.08); }
    .actionbar .ab-btn.primary{ background: rgba(139,197,63,.95); color:#0f172a; }

    /* Micro animations */
    @keyframes pop{ from{transform:translateY(6px); opacity:0} to{transform:none; opacity:1} }
    @keyframes float-in{ from{ transform:translateY(10px) scale(.98); opacity:0 } to{ transform:none; opacity:1 } }
    @keyframes shimmer{
      0%{ background-position: 0% 50% }
      100%{ background-position: 200% 50% }
    }
    .bar > i, .tile-bar > i{ background-size: 200% 100%; }

    /* Responsive tweaks */
    @media (min-width:760px){
      .wrap{padding:32px 20px 120px}
      .profile{ grid-template-columns: 110px 1fr; gap:18px; padding:18px; }
      .avatar{ width:100px; height:100px; border-radius:18px; }
      .info{ grid-template-columns: repeat(4, minmax(120px,1fr)); gap:12px; }
      .avg-grid{ grid-template-columns: repeat(4, minmax(160px,1fr)); }
      .exam-cards{ grid-template-columns: repeat(4, minmax(160px,1fr)); }
      .section h2{ font-size:22px }
      .logo{ font-size:28px }
      .title-block h1{ font-size:22px }
      .fab{ bottom:100px }
    }
    @media (max-width:760px){ .actions{ display:none; } }
    @media (prefers-reduced-motion: reduce){
      *{ animation:none !important; transition:none !important }
    }
    @media print{ .actions, .fab, .actionbar{ display:none !important; } header{ position:static; background:none; } }
  </style>

  <script>
    // ===== LOCK SCREEN LOGIC =====
    // SHA-256("fidhu123") = 60b180fd2a43a937923582bd342b09e7a8b3285c06bf932bb3e04931599dfe07
    const EXPECTED_HEX = "60b180fd2a43a937923582bd342b09e7a8b3285c06bf932bb3e04931599dfe07";

    document.addEventListener('DOMContentLoaded', () => {
      const overlay = document.getElementById('lock-overlay');
      if (sessionStorage.getItem('sehr-profile-unlocked') === '1') {
        document.body.classList.remove('locked');
        if (overlay) overlay.style.display = 'none';
      } else {
        document.body.classList.add('locked');
      }
    });

    async function sha256Hex(message) {
      const enc = new TextEncoder().encode(message);
      const buf = await crypto.subtle.digest('SHA-256', enc);
      const arr = Array.from(new Uint8Array(buf));
      return arr.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    async function tryUnlock(evt){
      evt?.preventDefault();
      const input = document.getElementById('lock-input');
      const err = document.getElementById('lock-err');
      const btn = document.getElementById('lock-btn');
      const overlay = document.getElementById('lock-overlay');
      const val = (input.value || '').trim();

      btn.disabled = true;
      err.textContent = '';

      try{
        const hex = await sha256Hex(val);
        if(hex === EXPECTED_HEX){
          sessionStorage.setItem('sehr-profile-unlocked','1');
          document.body.classList.remove('locked');
          overlay.style.opacity = '0';
          setTimeout(()=> overlay.style.display='none', 350);
          input.value = '';
        }else{
          err.textContent = 'Wrong password. Please try again.';
          input.select();
        }
      }catch(e){
        err.textContent = 'Unexpected error. Please try again.';
      }finally{
        btn.disabled = false;
      }
    }
  </script>
</head>

<body class="locked">
  <!-- ===== LOCK OVERLAY ===== -->
  <div class="lock-overlay" id="lock-overlay" role="dialog" aria-modal="true" aria-labelledby="lock-title">
    <div class="lock-card">
      <div class="lock-head" id="lock-title">
        <div class="brand"><b style="color:var(--sehr-green)">SEHR</b> ACADEMY</div>
        <span>— Protected Profile</span>
      </div>
      <div class="lock-sub">Enter password to view student data.</div>
      <form class="lock-form" onsubmit="tryUnlock(event)">
        <input id="lock-input" class="lock-input" type="password" inputmode="text" autocomplete="current-password" placeholder="Password" aria-label="Password" />
        <button id="lock-btn" type="submit" class="lock-btn">Unlock</button>
      </form>
      <div id="lock-err" class="lock-err" aria-live="polite"></div>
      <div class="lock-foot">Tip: Access is remembered for this tab until you close it.</div>
    </div>
  </div>

  <!-- ===== PAGE CONTENT ===== -->
  <div class="wrap">
    <header>
      <a class="logo" href="https://sehracademy.com" aria-label="Sehr Academy homepage">
        <div class="brand"><b>SEHR</b> ACADEMY</div>
      </a>
      <div class="title-block">
        <h1 onclick="window.location.href='https://sehracademy.com'" title="Go to homepage">Student Profile</h1>
      </div>
      <div class="actions">
        <button class="btn" id="btn-print">Print / PDF</button>
        <button class="btn" id="btn-csv">CSV</button>
      </div>
    </header>

    <!-- Profile Card -->
    <section class="card profile">
      <div class="avatar">
        <img src="https://i.postimg.cc/TPKm9W6G/96bd66a1aac05c9874603a461aea9a20.png" alt="Fidha profile photo">
      </div>
      <div class="info">
        <div class="k"><small>Student</small><b>Fidha</b></div>
        <div class="k"><small>Class</small><b>Plus One Science / Class 11</b></div>
        <div class="k"><small>Joining Date</small><b>2025-05-26</b></div>
        <div class="k"><small>Birthday</small><b>5th September</b></div>
      </div>
    </section>

    <!-- Results -->
    <section class="section card">
      <h2>Results</h2>

      <!-- Subject Average Boxes (auto-calculated) -->
      <div class="avg-grid" id="subject-averages">
        <div class="avg-card">
          <div class="avg-top"><span class="s">Physics</span><span class="v" id="avg-Physics">—</span></div>
          <div class="mini-bar"><i id="mini-Physics"></i></div>
          <span class="passchip" id="pf-Physics">—</span>
          <span class="wm">Φ</span>
        </div>
        <div class="avg-card">
          <div class="avg-top"><span class="s">Maths</span><span class="v" id="avg-Maths">—</span></div>
          <div class="mini-bar"><i id="mini-Maths"></i></div>
          <span class="passchip" id="pf-Maths">—</span>
          <span class="wm">∑</span>
        </div>
        <div class="avg-card">
          <div class="avg-top"><span class="s">Chemistry</span><span class="v" id="avg-Chemistry">—</span></div>
          <div class="mini-bar"><i id="mini-Chemistry"></i></div>
          <span class="passchip" id="pf-Chemistry">—</span>
          <span class="wm">⚗</span>
        </div>
        <div class="avg-card">
          <div class="avg-top"><span class="s">Biology</span><span class="v" id="avg-Biology">—</span></div>
          <div class="mini-bar"><i id="mini-Biology"></i></div>
          <span class="passchip" id="pf-Biology">—</span>
          <span class="wm">🌿</span>
        </div>
      </div>

      <!-- First Term -->
      <details class="term" open>
        <summary>
          <span>First Term</span>
          <span class="chip">May – Sep 2025</span>
        </summary>
        <div class="term-body" id="first-term">
          <!-- QP rows (data-driven) -->
          <div class="exam-row" data-subject="Physics">
            <div class="label">QP01</div>
            <div class="bar"><i data-pct="51"></i></div>
            <div class="pct">51%</div>
          </div>
          <div class="exam-row" data-subject="Maths">
            <div class="label">QP02</div>
            <div class="bar"><i data-pct="63"></i></div>
            <div class="pct">63%</div>
          </div>
          <div class="exam-row" data-subject="Chemistry">
            <div class="label">QP03</div>
            <div class="bar"><i data-pct="66"></i></div>
            <div class="pct">66%</div>
          </div>
          <div class="exam-row" data-subject="Biology">
            <div class="label">QP04</div>
            <div class="bar"><i data-pct="50"></i></div>
            <div class="pct">50%</div>
          </div>
          <div class="exam-row" data-subject="Physics">
            <div class="label">QP05</div>
            <div class="bar"><i data-pct="37"></i></div>
            <div class="pct">37%</div>
          </div>
          <div class="exam-row" data-subject="Maths">
            <div class="label">QP06</div>
            <div class="bar"><i data-pct="50"></i></div>
            <div class="pct">50%</div>
          </div>
          <div class="exam-row" data-subject="Chemistry">
            <div class="label">QP07</div>
            <div class="bar"><i data-pct="57"></i></div>
            <div class="pct">57%</div>
          </div>
          <div class="exam-row" data-subject="Biology">
            <div class="label">QP08</div>
            <div class="bar"><i data-pct="8"></i></div>
            <div class="pct">8%</div>
          </div>

          <div class="total-row">
            <h3>First Term Overview</h3>
            <div class="exam-row" style="padding-top:0;">
              <div class="label">Internals Average</div>
              <div class="bar"><i id="avg-bar" data-pct="0"></i></div>
              <div class="pct" id="avg-text">0%</div>
            </div>

            <!-- Summary metric boxes -->
            <div class="more-metrics">
              <div class="metric"><small>Attempted</small><b id="met-attempted">—</b></div>
              <div class="metric"><small>Passed</small><b id="met-passed">—</b></div>
              <div class="metric"><small>Failed</small><b id="met-failed">—</b></div>
            </div>

            <!-- External exam subject tiles (PERCENTAGE BARS) -->
            <div class="tiles-wrap">
              <div class="tiles-title">Sehr First Term Exam</div>
              <div class="exam-cards" id="sehr-tiles">
                <div class="exam-card sub-Physics">
                  <div class="tile-meta"><span class="s">Physics</span><span class="ptext" id="sehr-Physics-text">—</span></div>
                  <div class="tile-bar"><i id="sehr-Physics-bar" data-pct="65"></i></div>
                </div>
                <div class="exam-card sub-Maths">
                  <div class="tile-meta"><span class="s">Maths</span><span class="ptext" id="sehr-Maths-text">—</span></div>
                  <div class="tile-bar"><i id="sehr-Maths-bar" data-pct="1"></i></div>
                </div>
                <div class="exam-card sub-Chemistry">
                  <div class="tile-meta"><span class="s">Chemistry</span><span class="ptext" id="sehr-Chemistry-text">—</span></div>
                  <div class="tile-bar"><i id="sehr-Chemistry-bar" data-pct="87"></i></div>
                </div>
                <div class="exam-card sub-Biology">
                  <div class="tile-meta"><span class="s">Biology</span><span class="ptext" id="sehr-Biology-text">—</span></div>
                  <div class="tile-bar"><i id="sehr-Biology-bar" data-pct="47"></i></div>
                </div>
              </div>

              <div class="tiles-title">School First Term Exam</div>
              <div class="exam-cards" id="school-tiles">
                <div class="exam-card sub-Physics">
                  <div class="tile-meta"><span class="s">Physics</span><span class="ptext" id="school-Physics-text">—</span></div>
                  <div class="tile-bar"><i id="school-Physics-bar" data-pct="1"></i></div>
                </div>
                <div class="exam-card sub-Maths">
                  <div class="tile-meta"><span class="s">Maths</span><span class="ptext" id="school-Maths-text">—</span></div>
                  <div class="tile-bar"><i id="school-Maths-bar" data-pct="1"></i></div>
                </div>
                <div class="exam-card sub-Chemistry">
                  <div class="tile-meta"><span class="s">Chemistry</span><span class="ptext" id="school-Chemistry-text">—</span></div>
                  <div class="tile-bar"><i id="school-Chemistry-bar" data-pct="1"></i></div>
                </div>
                <div class="exam-card sub-Biology">
                  <div class="tile-meta"><span class="s">Biology</span><span class="ptext" id="school-Biology-text">—</span></div>
                  <div class="tile-bar"><i id="school-Biology-bar" data-pct="1"></i></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </details>
    </section>

    <!-- Achievements -->
    <section class="section card achievements">
      <h2>Other Achievements</h2>
      <div class="ach-grid">
        <div class="ach-card">
          <div class="ach-title">Event Coordinator</div>
        </div>
      </div>
    </section>

    <!-- Performance Remarks -->
    <section class="section card remarks">
      <h2>Performance Remarks</h2>
      <div style="height:12px;"></div>
    </section>

    <div class="foot">sehracademy.com</div>
  </div>

  <div class="tooltip" id="tooltip"></div>

  <!-- Floating edit FAB + bottom action bar -->
  <div class="fab"><button id="toggle-edit">✏️ Edit</button></div>
  <div class="actionbar" id="actionbar" style="display:none;">
    <button class="ab-btn" id="btn-export">Export JSON</button>
    <button class="ab-btn" id="btn-reset">Reset</button>
    <button class="ab-btn primary" id="btn-save">Save</button>
  </div>

  <script>
    /* Gradient helper for Internals + tiles */
    function perfGradient(pct){
      if(pct >= 75) return {bg:`linear-gradient(90deg, var(--shine1), var(--gld2))`, glow:'0 0 0 3px rgba(212,175,55,.25)'};
      if(pct >= 50) return {bg:`linear-gradient(90deg, var(--or1), var(--or2))`, glow:'none'};
      if(pct >= 30) return {bg:`linear-gradient(90deg, var(--red1), var(--red2))`, glow:'none'};
      return {bg:`linear-gradient(90deg, var(--darkred1), var(--darkred2))`, glow:'none'};
    }

    // Tooltip
    const tip = document.getElementById('tooltip');
    function showTip(e){ tip.textContent = e.currentTarget.getAttribute('data-tip') || ''; tip.style.opacity = '1'; }
    function moveTip(e){ tip.style.left = e.clientX + 'px'; tip.style.top = e.clientY + 'px'; }
    function hideTip(){ tip.style.opacity = '0'; }

    // State helpers
    const STORAGE_KEY = 'fidha-first-term-state-v2';
    let pristineState = null; // captured from DOM at first init

    function readStateFromDOM(){
      const rows = Array.from(document.querySelectorAll('#first-term .exam-row'));
      const internals = rows.filter(r=>r.querySelector('.label').textContent.trim().match(/^QP\d{2}$/)).map(r=>({
        id: r.querySelector('.label').textContent.trim(),
        subject: r.dataset.subject || 'Other',
        score: Number(r.querySelector('.bar > i').dataset.pct || 0)
      }));
      const externals = { sehr:{}, school:{} };
      ['Physics','Maths','Chemistry','Biology'].forEach(s=>{
        externals.sehr[s]   = Number(document.getElementById(`sehr-${s.replace(/\s+/g,'')}-bar`).dataset.pct || '');
        externals.school[s] = Number(document.getElementById(`school-${s.replace(/\s+/g,'')}-bar`).dataset.pct || '');
      });
      return { internals, externals };
    }

    function writeStateToDOM(state){
      // Internals
      const map = new Map(state.internals.map(e=>[e.id, e]));
      document.querySelectorAll('#first-term .exam-row').forEach(row=>{
        const id = row.querySelector('.label').textContent.trim();
        if(map.has(id)){
          const {score} = map.get(id);
          const pctEl = row.querySelector('.bar > i');
          pctEl.dataset.pct = score;
          row.querySelector('.pct').textContent = `${Math.round(score)}%`;
        }
      });
      // External tiles
      ['Physics','Maths','Chemistry','Biology'].forEach(s=>{
        const id = s.replace(/\s+/g,'');
        document.getElementById(`sehr-${id}-bar`).dataset.pct   = state.externals.sehr[s] ?? '';
        document.getElementById(`school-${id}-bar`).dataset.pct = state.externals.school[s] ?? '';
      });
      // Recalc visuals
      initFirstTerm();
    }

    function saveLocal(state){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
    function loadLocal(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)||''); }catch{ return null } }

    function setBar(el, pct){
      if(!el) return;
      const p = (pct==null || isNaN(pct)) ? 0 : Math.max(0, Math.min(100, Math.round(pct)));
      const st = perfGradient(p);
      el.style.background = st.bg;
      el.style.boxShadow = (st.glow !== 'none') ? st.glow : 'none';
      el.style.animation = 'shimmer 2.2s linear infinite';
      requestAnimationFrame(()=>{ el.style.width = p + '%'; });
      const wrap = el.parentElement;
      if(wrap){ wrap.setAttribute('data-tip', `${p}%`); wrap.addEventListener('mouseenter', showTip); wrap.addEventListener('mousemove', moveTip); wrap.addEventListener('mouseleave', hideTip); }
    }

    function fillTiles(prefix){
      ['Physics','Maths','Chemistry','Biology'].forEach(subj => {
        const id = subj.replace(/\s+/g,'');
        const el = document.getElementById(`${prefix}-${id}-bar`);
        const val = Number(el.dataset.pct || 0);
        setBar(el, val);
        const txtEl  = document.getElementById(`${prefix}-${id}-text`);
        if(txtEl){ txtEl.textContent = (isNaN(val) ? '—' : (val + '%')); }
      });
    }

    function initFirstTerm(){
      const rows = Array.from(document.querySelectorAll('#first-term .exam-row'));
      const bars = rows.map(r => r.querySelector('.bar > i'));
      const avgBar = document.getElementById('avg-bar');
      const avgText = document.getElementById('avg-text');

      // Paint bars + tooltips for Internals (QP01–QP08)
      rows.forEach(row => {
        const pct = Number(row.querySelector('.bar > i').dataset.pct || 0);
        const bar = row.querySelector('.bar > i');
        const style = perfGradient(pct);
        bar.style.background = style.bg;
        if(style.glow !== 'none') bar.style.boxShadow = style.glow;
        bar.style.animation = 'shimmer 2.2s linear infinite';
        requestAnimationFrame(()=>{ bar.style.width = pct + '%'; });

        const subj = row.dataset.subject || '—';
        const qp = row.querySelector('.label')?.textContent || '';
        const barWrap = row.querySelector('.bar');
        barWrap.setAttribute('data-tip', `${qp} · ${subj} · ${pct}%`);
        barWrap.addEventListener('mouseenter', showTip);
        barWrap.addEventListener('mousemove', moveTip);
        barWrap.addEventListener('mouseleave', hideTip);

        // When in edit mode, ensure input is in place
        const pctCell = row.querySelector('.pct');
        if(document.body.classList.contains('editing')){
          if(!pctCell.querySelector('input')){
            const input = document.createElement('input');
            input.type = 'number'; input.min = '0'; input.max = '100'; input.step = '1'; input.className = 'tile-input';
            input.value = Math.round(pct);
            input.addEventListener('input', ()=>{ setBar(bar, Number(input.value||0)); });
            pctCell.textContent = '';
            pctCell.appendChild(input);
          }
        }else{
          if(pctCell.querySelector('input')){
            const val = Number(pctCell.querySelector('input').value||0);
            pctCell.textContent = `${Math.round(val)}%`;
          }
        }
      });

      // Internals average
      const values = bars.map(el => Number(el.dataset.pct || 0));
      const attempted = values.filter(v => v > 0).length;
      const overall = values.reduce((a,b)=>a+b,0) / (values.length || 1);
      const shown = Math.round(overall * 10)/10;
      const styleAvg = perfGradient(shown);
      avgBar.style.background = styleAvg.bg;
      if(styleAvg.glow !== 'none') avgBar.style.boxShadow = styleAvg.glow;
      avgBar.style.animation = 'shimmer 2.4s linear infinite';
      requestAnimationFrame(()=>{ avgBar.style.width = shown + '%'; });
      avgText.textContent = shown + '%';

      // Subject averages + per-subject pass labels
      const groups = {};
      rows.forEach(row => {
        const subj = row.dataset.subject || 'Other';
        const val = Number(row.querySelector('.bar > i').dataset.pct || 0);
        (groups[subj] ||= []).push(val);
      });
      Object.entries(groups).forEach(([subj, arr])=>{
        const avg = arr.reduce((a,b)=>a+b,0) / arr.length;
        const rounded = Math.round(avg*10)/10;
        const pass = arr.filter(v=>v>=50).length;
        const key = subj.replace(/\s+/g,'');
        const textEl = document.getElementById('avg-' + key);
        const miniEl = document.getElementById('mini-' + key);
        const pfEl = document.getElementById('pf-' + key);
        if(textEl){
          textEl.textContent = rounded + '%';
          textEl.style.background = perfGradient(rounded).bg;
          textEl.style.webkitBackgroundClip = 'text';
          textEl.style.backgroundClip = 'text';
          textEl.style.color = 'transparent';
        }
        if(miniEl){
          const st = perfGradient(rounded);
          miniEl.style.background = st.bg;
          miniEl.style.animation = 'shimmer 2.8s linear infinite';
          requestAnimationFrame(()=>{ miniEl.style.width = rounded + '%'; });
        }
        if(pfEl){ pfEl.textContent = `${pass}/${arr.length} passed`; }
      });

      // Metrics
      const passed = values.filter(v => v >= 50).length;
      const failed = values.filter(v => v > 0 && v < 50).length;
      document.getElementById('met-attempted').textContent = attempted;
      document.getElementById('met-passed').textContent = passed;
      document.getElementById('met-failed').textContent = failed;

      // External tiles
      fillTiles('sehr');
      fillTiles('school');

      // If editing, mount inputs for tiles too
      if(document.body.classList.contains('editing')){
        ['sehr','school'].forEach(prefix=>{
          ['Physics','Maths','Chemistry','Biology'].forEach(subj=>{
            const id = subj.replace(/\s+/g,'');
            const txt = document.getElementById(`${prefix}-${id}-text`);
            if(!txt) return;
            if(!txt.querySelector('input')){
              const barEl = document.getElementById(`${prefix}-${id}-bar`);
              const current = Number(barEl.dataset.pct||0);
              const input = document.createElement('input');
              input.type='number'; input.min='0'; input.max='100'; input.step='1'; input.className='tile-input'; input.value = Math.round(current);
              input.addEventListener('input', ()=> setBar(barEl, Number(input.value||0)) );
              txt.textContent='';
              txt.appendChild(input);
            }
          });
        });
      } else {
        // ensure numbers are printed when not editing
        ['sehr','school'].forEach(prefix=>{
          ['Physics','Maths','Chemistry','Biology'].forEach(subj=>{
            const id = subj.replace(/\s+/g,'');
            const txt = document.getElementById(`${prefix}-${id}-text`);
            const barEl = document.getElementById(`${prefix}-${id}-bar`);
            if(txt){ txt.textContent = (barEl?.dataset?.pct ? Math.round(Number(barEl.dataset.pct)) + '%' : '—'); }
          });
        });
      }
    }

    // Buttons (print, csv)
    document.addEventListener('DOMContentLoaded', ()=>{
      document.getElementById('btn-print')?.addEventListener('click', ()=> window.print());
      document.getElementById('btn-csv')?.addEventListener('click', downloadCSV);

      // Capture pristine state once
      pristineState = readStateFromDOM();

      // Load saved state if present
      const saved = loadLocal();
      if(saved){ writeStateToDOM(saved); } else { initFirstTerm(); }

      // Edit mode toggles
      const toggle = document.getElementById('toggle-edit');
      const bar = document.getElementById('actionbar');
      toggle.addEventListener('click', ()=>{
        const editing = document.body.classList.toggle('editing');
        bar.style.display = editing ? 'flex' : 'none';
        toggle.textContent = editing ? '✅ Done' : '✏️ Edit';
        initFirstTerm();
        window.scrollTo({top:0, behavior:'smooth'});
      });

      document.getElementById('btn-save').addEventListener('click', ()=>{
        // Collect from inputs when editing
        const state = readStateFromDOMFromInputs();
        saveLocal(state);
        document.body.classList.remove('editing');
        bar.style.display = 'none';
        toggle.textContent = '✏️ Edit';
        writeStateToDOM(state);
      });

      document.getElementById('btn-reset').addEventListener('click', ()=>{
        if(!confirm('Reset marks to original values?')) return;
        localStorage.removeItem(STORAGE_KEY);
        writeStateToDOM(pristineState);
        document.body.classList.remove('editing');
        bar.style.display = 'none';
        document.getElementById('toggle-edit').textContent = '✏️ Edit';
      });

      document.getElementById('btn-export').addEventListener('click', ()=>{
        const state = readStateFromDOMFromInputs();
        const json = JSON.stringify(state, null, 2);
        navigator.clipboard?.writeText(json).then(()=>{
          alert('Copied JSON to clipboard. You can paste and save this for records.');
        },()=>{
          // Fallback: download as file
          const blob = new Blob([json], {type:'application/json'});
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url; a.download = 'fidha-first-term.json';
          document.body.appendChild(a); a.click(); a.remove();
          setTimeout(()=>URL.revokeObjectURL(url), 1000);
        });
      });
    });

    function readStateFromDOMFromInputs(){
      // If editing, prefer reading values from input fields; otherwise from dataset
      const rows = Array.from(document.querySelectorAll('#first-term .exam-row'));
      const internals = rows.filter(r=>r.querySelector('.label').textContent.trim().match(/^QP\d{2}$/)).map(r=>{
        const id = r.querySelector('.label').textContent.trim();
        const subject = r.dataset.subject || 'Other';
        const input = r.querySelector('.pct input');
        const score = input ? Number(input.value||0) : Number(r.querySelector('.bar > i').dataset.pct || 0);
        return {id, subject, score: Math.max(0, Math.min(100, Math.round(score))) };
      });
      const externals = { sehr:{}, school:{} };
      ['sehr','school'].forEach(prefix=>{
        ['Physics','Maths','Chemistry','Biology'].forEach(subj=>{
          const id = subj.replace(/\s+/g,'');
          const input = document.querySelector(`#${prefix}-${id}-text input`);
          const bar   = document.getElementById(`${prefix}-${id}-bar`);
          const val = input ? Number(input.value||0) : Number(bar.dataset.pct||0);
          externals[prefix][subj] = Math.max(0, Math.min(100, Math.round(val)));
        });
      });
      return {internals, externals};
    }

    function downloadCSV(){
      const rows = Array.from(document.querySelectorAll('#first-term .exam-row'));
      const exams = rows.filter(r=>r.querySelector('.label').textContent.trim().match(/^QP\d{2}$/)).map(r => {
        const id = r.querySelector('.label').textContent.trim();
        const subject = r.dataset.subject || '';
        const input = r.querySelector('.pct input');
        const score = input ? (input.value||'0') : (r.querySelector('.bar > i').dataset.pct || '0');
        return {id, subject, score};
      });
      const subjMap = {};
      exams.forEach(e=>{ (subjMap[e.subject] ||= []).push(Number(e.score)); });
      let csv = 'Exam,Subject,Score (%)\n';
      exams.forEach(e=>{ csv += `${e.id},${e.subject},${e.score}\n`; });
      csv += '\nSubject,Average (%),Passed,Failed\n';
      Object.entries(subjMap).forEach(([s,arr])=>{
        const avg = arr.reduce((a,b)=>a+b,0)/arr.length;
        const passed = arr.filter(v=>v>=50).length;
        const failed = arr.filter(v=>v<50).length;
        csv += `${s},${Math.round(avg*10)/10},${passed},${failed}\n`;
      });
      // external exams
      csv += '\nSehr First Term Exam\nSubject,Score (%)\n';
      ;['Physics','Maths','Chemistry','Biology'].forEach(subj=>{
        const el = document.getElementById(`sehr-${subj.replace(/\s+/g,'')}-bar`);
        const v = el ? el.dataset.pct : '';
        csv += `${subj},${(v==null?'':v)}\n`;
      });
      csv += '\nSchool First Term Exam\nSubject,Score (%)\n';
      ;['Physics','Maths','Chemistry','Biology'].forEach(subj=>{
        const el = document.getElementById(`school-${subj.replace(/\s+/g,'')}-bar`);
        const v = el ? el.dataset.pct : '';
        csv += `${subj},${(v==null?'':v)}\n`;
      });

      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'fidha-first-term.csv';
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=>URL.revokeObjectURL(url), 1000);
    }
  </script>
</body>
</html>
