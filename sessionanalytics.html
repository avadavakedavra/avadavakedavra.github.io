<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SEHR Academy â€” Session Analytics</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800;900&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --green:#8BC53F;
  --radius:22px;
  --shadow:0 20px 45px rgba(15,23,42,.12);
}
body{
  margin:0;
  font-family:Nunito,sans-serif;
  background:linear-gradient(180deg,#ffffff,#f7f8fa);
}
.container{
  max-width:1100px;
  margin:auto;
  padding:40px 20px;
}
h1{
  font-family:Montserrat;
  font-weight:900;
  text-align:center;
  margin-bottom:30px;
}
.controls{
  display:flex;
  gap:15px;
  justify-content:center;
  flex-wrap:wrap;
  margin-bottom:30px;
}
select,button{
  padding:12px 18px;
  border-radius:14px;
  border:1px solid #e5e7eb;
  font-weight:700;
}
button{
  background:var(--green);
  color:white;
  border:none;
  cursor:pointer;
}
.panel{
  background:white;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:25px;
}
table{
  width:100%;
  border-collapse:collapse;
  font-family:Montserrat;
}
th,td{
  padding:14px;
  text-align:center;
}
th{
  border-bottom:2px solid var(--green);
  font-size:13px;
  letter-spacing:.5px;
}
tr:hover{
  background:#f4f9ef;
}
.total{
  background:#eaf6de;
  font-weight:900;
}
.stats{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:20px;
  margin-top:30px;
}
.stat-card{
  background:white;
  border-radius:18px;
  padding:20px;
  box-shadow:var(--shadow);
  text-align:center;
}
.stat-card h2{
  font-family:Montserrat;
  font-size:28px;
  margin:10px 0;
}
.stat-card p{
  font-weight:700;
  color:#6b7280;
}
</style>
</head>
<body>

<div class="container">

<h1>Session Analytics Dashboard</h1>

<div class="controls">
  <select id="classSelect">
    <option value="">Select Class</option>
    <option>Class 12</option>
    <option>Class 11</option>
    <option>Class 10</option>
  </select>

  <select id="subjectSelect">
    <option value="">Select Subject</option>
    <option>Mathematics</option>
    <option>Physics</option>
    <option>Chemistry</option>
    <option>Biology</option>
  </select>

  <button onclick="loadData()">Analyze</button>
</div>

<div class="panel">
  <table id="resultTable" style="display:none;">
    <thead>
      <tr>
        <th>Month</th>
        <th>Online</th>
        <th>Offline</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div class="stats" id="statsSection" style="display:none;">
  <div class="stat-card">
    <p>Total Sessions</p>
    <h2 id="totalSessions">0</h2>
  </div>
  <div class="stat-card">
    <p>Completed Sessions</p>
    <h2 id="completedSessions">0</h2>
  </div>
  <div class="stat-card">
    <p>Pending Sessions</p>
    <h2 id="pendingSessions">0</h2>
  </div>
</div>

</div>

<script>

const SHEET_ID  = "1d5b07U_wV7Dn6RKRpVGhN1hCzdD8NJK9tKli_VIaIoo";
const API_KEY   = "AIzaSyBwUJ420X5QdIfPBJ_BM-ZoFiu2gWxPsjo";
const SHEET_NAME = "events";

async function loadData(){

  const selectedClass = document.getElementById("classSelect").value;
  const selectedSubject = document.getElementById("subjectSelect").value;

  if(!selectedClass || !selectedSubject){
    alert("Please select Class and Subject");
    return;
  }

  const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;
  const res = await fetch(url);
  const data = await res.json();

  if(!data.values){
    alert("Unable to fetch data. Check sheet permissions.");
    return;
  }

  const rows = data.values.slice(1);

  const monthMap = {};
  let completed = 0;
  let pending = 0;
  const today = new Date();

  rows.forEach(row => {

    const dateStr = row[0];
    const mode = row[1];
    const subject = row[2];
    const className = row[6];

    if(!dateStr) return;

    if(className === selectedClass &&
      (subject === selectedSubject || subject === "All Subjects")){

      const sessionDate = new Date(dateStr);
      const month = sessionDate.toLocaleString('default',{month:'long', year:'numeric'});

      if(!monthMap[month]){
        monthMap[month] = {online:0, offline:0};
      }

      if(mode === "Online") monthMap[month].online++;
      if(mode === "Offline") monthMap[month].offline++;

      if(sessionDate < today) completed++;
      else pending++;
    }

  });

  const tbody = document.querySelector("#resultTable tbody");
  tbody.innerHTML = "";

  let totalOnline = 0;
  let totalOffline = 0;

  for(const month in monthMap){
    const online = monthMap[month].online;
    const offline = monthMap[month].offline;
    const total = online + offline;

    totalOnline += online;
    totalOffline += offline;

    tbody.innerHTML += `
      <tr>
        <td>${month}</td>
        <td>${online}</td>
        <td>${offline}</td>
        <td>${total}</td>
      </tr>
    `;
  }

  tbody.innerHTML += `
    <tr class="total">
      <td>Grand Total</td>
      <td>${totalOnline}</td>
      <td>${totalOffline}</td>
      <td>${totalOnline + totalOffline}</td>
    </tr>
  `;

  document.getElementById("resultTable").style.display = "table";
  document.getElementById("statsSection").style.display = "grid";

  document.getElementById("totalSessions").innerText = totalOnline + totalOffline;
  document.getElementById("completedSessions").innerText = completed;
  document.getElementById("pendingSessions").innerText = pending;
}

</script>

</body>
</html>
