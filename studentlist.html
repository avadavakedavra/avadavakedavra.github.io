<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sehr Academy — Student Database</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --green:#8BC53F;
  --border:#e6e8ec;
  --bg:#f8f7f4;
}

body{
  margin:0;
  font-family:'Nunito',sans-serif;
  background:var(--bg);
  color:#1f2937;
}

/* HEADER */
header{
  background:#fff;
  border-bottom:1px solid var(--border);
  position:sticky;
  top:0;
  z-index:1000;
}

.wrap{
  max-width:1200px;
  margin:auto;
  padding:14px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.brand{
  cursor:pointer;
}

.brand span:first-child{
  font-family:'Montserrat';
  font-weight:900;
  color:var(--green);
  font-size:22px;
}

.brand span:last-child{
  font-family:'Montserrat';
  font-weight:900;
  font-size:22px;
}

.page-badge{
  font-weight:700;
  background:#f2f4f7;
  padding:6px 12px;
  border-radius:8px;
  font-size:13px;
}

/* HEADING + FILTERS */
.heading{
  max-width:1200px;
  margin:20px auto;
  padding:0 20px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}

.filter{
  position:relative;
}

.filter-btn{
  padding:8px 14px;
  border:1px solid var(--border);
  border-radius:8px;
  background:#fff;
  font-weight:700;
  cursor:pointer;
  min-width:120px;
  text-align:left;
}

.filter-menu{
  position:absolute;
  top:110%;
  left:0;
  background:#fff;
  border:1px solid var(--border);
  border-radius:10px;
  box-shadow:0 12px 25px rgba(0,0,0,.15);
  padding:10px;
  display:none;
  max-height:250px;
  overflow:auto;
  z-index:999;
}

.filter-menu div{
  padding:6px 8px;
  font-size:14px;
  cursor:pointer;
  border-radius:6px;
}

.filter-menu div:hover{
  background:#f2f4f7;
}

.filter.open .filter-menu{
  display:block;
}

.search{
  padding:8px 12px;
  border:1px solid var(--border);
  border-radius:8px;
  font-weight:600;
}

/* TABLE */
.table-wrap{
  max-width:1200px;
  margin:auto;
  padding:20px;
}

table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  border:1px solid var(--border);
  border-radius:12px;
  overflow:hidden;
}

th{
  background:#fff;
  font-family:'Montserrat';
  font-weight:800;
  padding:14px;
  text-align:left;
  border-bottom:1px solid var(--border);
}

td{
  padding:14px;
  border-top:1px solid var(--border);
  font-size:14px;
}

tbody tr{
  transition:.2s ease;
  cursor:pointer;
}

tbody tr:hover{
  background:#f4f7f2;
  transform:scale(1.01);
}

.student-name{
  display:flex;
  align-items:center;
  gap:10px;
}

.student-name img{
  width:38px;
  height:38px;
  border-radius:50%;
  object-fit:cover;
  border:2px solid var(--border);
}

.pill{
  display:inline-block;
  font-size:11px;
  font-weight:700;
  padding:4px 8px;
  border-radius:6px;
  border:1px solid #ddd;
  background:#fff;
}

.pill.class{
  background:#eef5e6;
  border:none;
}

.empty{
  text-align:center;
  padding:40px;
  font-weight:600;
  opacity:.5;
}
</style>
</head>

<body>

<header>
<div class="wrap">
<div class="brand" onclick="window.location.href='https://sehracademy.com'">
<span>SEHR</span><span>ACADEMY</span>
</div>
<div class="page-badge">Student Database</div>
</div>
</header>

<div class="heading">

<div class="filter">
<button class="filter-btn" id="classBtn">Class ▾</button>
<div class="filter-menu" id="classMenu"></div>
</div>

<div class="filter">
<button class="filter-btn" id="syllabusBtn">Syllabus ▾</button>
<div class="filter-menu" id="syllabusMenu"></div>
</div>

<select id="sortSelect" class="filter-btn">
<option value="">Sort By</option>
<option value="name">Name A-Z</option>
<option value="class">Class</option>
<option value="admission">Admission No</option>
</select>

<input type="text" id="searchInput" class="search" placeholder="Search name...">

</div>

<div class="table-wrap">
<table>
<thead>
<tr>
<th>Name</th>
<th>Admission No</th>
<th>Class</th>
<th>Syllabus</th>
<th>School</th>
<th>Joining Date</th>
</tr>
</thead>
<tbody id="studentBody"></tbody>
</table>
</div>

<script>

const BASE_URL = "https://script.google.com/macros/s/AKfycbxDGwmT8fs6X2bTKO2d9dhpgr9k11BygstAG5aT51dqRBa2f9-dojKrI-F7Ll57xCMh/exec";

let STUDENTS = [];
let USER_PASSWORD = "";
let selectedClass = "";
let selectedSyllabus = "";
let searchValue = "";

/* ================= PASSWORD PROMPT ================= */

window.addEventListener("load", () => {
  showPasswordPrompt();
});

function showPasswordPrompt(){
  const pass = prompt("Enter Admin Password:");
  
  if(!pass){
    alert("Access required.");
    showPasswordPrompt();
    return;
  }

  USER_PASSWORD = pass;
  fetchStudents();
}

/* ================= FETCH ================= */

async function fetchStudents(){

  try{

    const url = `${BASE_URL}?action=studentList&password=${encodeURIComponent(USER_PASSWORD)}`;
    const res = await fetch(url);
    const data = await res.json();

    if(data.error){
      alert("Incorrect password.");
      showPasswordPrompt();
      return;
    }

    STUDENTS = data.students || [];
    populateFilters();
    render();

  } catch(err){
    alert("Server error.");
  }
}

/* ================= FILTER POPULATION ================= */

function populateFilters(){
  const classes = [...new Set(STUDENTS.map(s=>s.class))].filter(Boolean).sort();
  const syllabus = [...new Set(STUDENTS.map(s=>s.syllabus))].filter(Boolean).sort();

  classMenu.innerHTML="";
  syllabusMenu.innerHTML="";

  classes.forEach(c=>{
    classMenu.innerHTML += `<div data-value="${c}">${c}</div>`;
  });

  syllabus.forEach(s=>{
    syllabusMenu.innerHTML += `<div data-value="${s}">${s}</div>`;
  });

  document.querySelectorAll("#classMenu div").forEach(item=>{
    item.onclick=()=>{
      selectedClass=item.dataset.value;
      classBtn.textContent=selectedClass+" ▾";
      render();
    }
  });

  document.querySelectorAll("#syllabusMenu div").forEach(item=>{
    item.onclick=()=>{
      selectedSyllabus=item.dataset.value;
      syllabusBtn.textContent=selectedSyllabus+" ▾";
      render();
    }
  });
}

/* ================= RENDER ================= */

function render(){

  let filtered = [...STUDENTS];

  if(selectedClass){
    filtered = filtered.filter(s=>String(s.class)===selectedClass);
  }

  if(selectedSyllabus){
    filtered = filtered.filter(s=>String(s.syllabus)===selectedSyllabus);
  }

  if(searchValue){
    filtered = filtered.filter(s=>s.full_name.toLowerCase().includes(searchValue));
  }

  const sort = sortSelect.value;

  if(sort==="name"){
    filtered.sort((a,b)=>a.full_name.localeCompare(b.full_name));
  }

  if(sort==="class"){
    filtered.sort((a,b)=>Number(a.class)-Number(b.class));
  }

  if(sort==="admission"){
    filtered.sort((a,b)=>a.admission_no.localeCompare(b.admission_no));
  }

  const body = document.getElementById("studentBody");
  body.innerHTML="";

  if(filtered.length===0){
    body.innerHTML=`<tr><td colspan="6" class="empty">No students found.</td></tr>`;
    return;
  }

  filtered.forEach(s=>{
    body.innerHTML += `
      <tr onclick="openStudent('${s.id}')">
        <td>
          <div class="student-name">
            <img src="${s.photo || ''}">
            ${s.full_name}
          </div>
        </td>
        <td>${s.admission_no}</td>
        <td><span class="pill class">${s.class}</span></td>
        <td>${s.syllabus}</td>
        <td>${s.school_name}</td>
        <td>${s.joining_date}</td>
      </tr>
    `;
  });
}

/* ================= OPEN PROFILE ================= */

function openStudent(id){
  window.open(`https://sehracademy.com/student?id=${encodeURIComponent(id)}`, '_blank');
}

/* ================= EVENTS ================= */

searchInput.oninput=e=>{
  searchValue=e.target.value.toLowerCase();
  render();
};

sortSelect.onchange=render;

document.querySelectorAll(".filter-btn").forEach(btn=>{
  btn.addEventListener("click",function(){
    this.parentElement.classList.toggle("open");
  });
});

document.addEventListener("click",function(e){
  document.querySelectorAll(".filter").forEach(f=>{
    if(!f.contains(e.target)){
      f.classList.remove("open");
    }
  });
});

</script>
</body>
</html>
