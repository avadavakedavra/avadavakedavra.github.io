<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sehr Academy — Schedule</title>
<meta name="theme-color" content="#8BC53F" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --primary:#8BC53F; --text:#0f172a; --muted:#64748b; --bg:#f7faf5; /* keep theme */
    --border:rgba(15,23,42,.08); --maxw:1180px; --radius:16px;
    --card-bg:#ffffff;
  }
  *{box-sizing:border-box}
  html,body{margin:0}
  body{
    font-family:Nunito,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:var(--text); background:var(--bg); line-height:1.65;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }

  /* ====== Header (exact design you gave) ====== */
  header{position:sticky;top:0;z-index:40;background:rgba(255,255,255,.78);border-bottom:1px solid rgba(230,232,236,.6);backdrop-filter:saturate(175%) blur(10px)}
  .container{max-width:var(--maxw);margin:0 auto;padding:0 20px}
  .nav{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
  .brand{display:flex;align-items:baseline;gap:8px;text-decoration:none}
  .brand span:nth-child(1){font-family:"Montserrat",sans-serif;font-weight:800;font-size:26px;color:var(--primary);letter-spacing:.4px}
  .brand span:nth-child(2){font-family:"Montserrat",sans-serif;font-weight:800;font-size:26px;color:#0b0f10;letter-spacing:.4px}
  nav[aria-label="Primary"] a{
    font-family:"Montserrat",sans-serif;color:#0b0f10;text-decoration:none;margin-left:16px;font-weight:700;font-size:14px;letter-spacing:.2px;position:relative
  }
  nav[aria-label="Primary"] a:after{content:"";position:absolute;left:0;bottom:-6px;width:0;height:2px;background:var(--primary);transition:width .18s}
  nav[aria-label="Primary"] a:hover{color:var(--primary)}
  nav[aria-label="Primary"] a:hover:after{width:100%}

  main section{padding:54px 0}

  /* ====== Toolbar (title + filters aligned) ====== */
  .toolbar{
    background:#fff;border:1px solid var(--border);border-radius:var(--radius);
    padding:20px;box-shadow:0 10px 26px rgba(16,24,40,.06)
  }
  .toolbar-grid{
    display:grid;grid-template-columns:1fr 1.2fr;gap:18px;align-items:center;
  }
  @media (max-width:900px){ .toolbar-grid{grid-template-columns:1fr} }

  .title-wrap{display:flex;flex-direction:column;gap:6px}
  h1{margin:0;font-family:Montserrat;font-weight:800;font-size:28px;letter-spacing:.2px}
  .subtitle{color:var(--muted);font-weight:700}

  .controls{
    display:grid;grid-template-columns:auto auto 1fr;gap:10px;align-items:center;
  }
  @media (max-width:700px){ .controls{grid-template-columns:1fr 1fr;grid-auto-rows:auto} }

  .segmented{
    display:inline-flex;border:1px solid var(--border);border-radius:999px;overflow:hidden;background:#fff
  }
  .segmented button{
    padding:10px 14px;border:0;background:transparent;font-weight:800;cursor:pointer
  }
  .segmented button[aria-pressed="true"]{background:#eff7e6}

  .chipbar{display:flex;gap:8px;flex-wrap:wrap}
  .chip{
    display:inline-flex;align-items:center;padding:8px 12px;border-radius:999px;border:1px solid var(--border);
    background:#fff;font-weight:800;cursor:pointer
  }
  .chip[aria-pressed="true"]{outline:3px solid #e7f5d5}

  .search{width:100%}
  .search input{
    width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#fff;font-weight:800
  }

  /* ====== Timeline / Events ====== */
  .timeline{position:relative;margin-top:18px}
  .tl-month{
    position:sticky;top:84px;z-index:5;margin:24px 0 12px;display:inline-block;
    padding:6px 12px;border-radius:10px;font-weight:900;background:#f0f7e7;border:1px solid #e0f2c8;
  }
  .tl-list{position:relative}
  .tl-line{position:absolute;left:18px;top:0;bottom:0;width:2px;background:#e6eedb}
  .tl-item{position:relative;padding-left:56px;margin:14px 0}
  .tl-dot{position:absolute;left:10px;top:22px;width:16px;height:16px;border-radius:50%;background:#fff;border:3px solid var(--primary);box-shadow:0 0 0 4px rgba(139,197,63,.15)}
  .event{border:1px solid var(--border);border-radius:14px;background:#fff;box-shadow:0 8px 24px rgba(16,24,40,.06)}
  .card-inner{padding:16px}

  /* Green date bar */
  .date-bar{
    display:flex;gap:10px;align-items:center;flex-wrap:wrap;
    background:var(--primary);color:#fff;border-radius:10px;padding:6px 10px;font-family:Montserrat;font-weight:900;
  }
  .time-badge{font-weight:900;padding:4px 8px;border-radius:8px;background:rgba(255,255,255,.22);border:1px solid rgba(255,255,255,.35)}
  .title{font-family:Montserrat;font-weight:800;margin-top:10px;font-size:18px}
  .meta{color:var(--muted);font-weight:800;margin-top:4px}
  .note{margin-top:8px}
  .today .event{box-shadow:0 12px 28px rgba(139,197,63,.12)}
  .past .event{opacity:.95}

  /* States */
  .skeleton{animation:pulse 1.2s ease-in-out infinite;background:linear-gradient(90deg,#f0f3ee,#f7faf5,#f0f3ee);background-size:200% 100%}
  @keyframes pulse{0%{background-position:0 0}100%{background-position:200% 0}}
  .sk-item{height:84px;border-radius:14px;margin:12px 0}
  .empty{padding:16px;border-radius:14px;background:#fff;border:1px dashed #e2e8f0;text-align:center;font-weight:900;color:#6b7280}
  .error{padding:16px;border-radius:14px;background:#fff5f5;border:1px solid #fecaca;color:#b91c1c}

  /* WhatsApp button */
  .cta-wrap{display:flex;justify-content:center;padding:28px 0 80px}
  .btn{
    display:inline-flex;align-items:center;gap:10px;padding:12px 18px;border-radius:999px;
    background:#25D366;color:#fff;text-decoration:none;font-weight:900;border:0;box-shadow:0 8px 20px rgba(37,211,102,.25)
  }
  .btn:hover{filter:brightness(.95)}
  .btn svg{width:18px;height:18px}
</style>
</head>
<body>

<header id="site-header"></header>
<script src="/assets/nav.js" defer></script>

<main>
  <section>
    <div class="container">
      <!-- Toolbar: title left, filters right -->
      <div class="toolbar">
        <div class="toolbar-grid">
          <div class="title-wrap">
            <h1>Schedule</h1>
            <div class="subtitle">Tests & events, updated regularly</div>
          </div>

          <div class="controls">
            <div class="segmented" role="tablist" aria-label="View">
              <button id="toggle-upcoming" role="tab" aria-selected="true" aria-pressed="true">Upcoming</button>
              <button id="toggle-past" role="tab" aria-selected="false" aria-pressed="false">Past</button>
            </div>

            <div id="class-chips" class="chipbar" aria-label="Filter by class"></div>

            <div class="search">
              <input id="search" type="search" placeholder="Search title or notes…" aria-label="Search schedule" />
            </div>
          </div>
        </div>
      </div>

      <!-- Loading -->
      <div id="skeleton" style="margin-top:16px">
        <div class="sk-item skeleton"></div><div class="sk-item skeleton"></div><div class="sk-item skeleton"></div>
      </div>

      <!-- Results -->
      <div id="timeline" class="timeline" hidden></div>
      <div id="empty" class="empty" hidden>No items match your filters.</div>
      <div id="error" class="error" hidden>Couldn’t load the schedule.</div>
    </div>
  </section>
</main>

<section id="contact">
  <div class="container cta-wrap">
    <a class="btn" href="https://wa.me/919539409586" target="_blank" rel="noopener" aria-label="Chat on WhatsApp">
      <svg viewBox="0 0 32 32" aria-hidden="true"><path d="M19.11 17.08c-.31-.16-1.82-.9-2.1-1.01-.28-.1-.48-.16-.68.17-.2.33-.78 1.01-.96 1.22-.18.2-.35.23-.66.08-.31-.16-1.32-.49-2.51-1.56-.93-.83-1.56-1.86-1.74-2.17-.18-.31-.02-.48.14-.64.14-.14.31-.35.47-.53.16-.18.2-.31.31-.52.1-.2.05-.39-.02-.55-.08-.16-.68-1.63-.93-2.23-.24-.58-.49-.5-.68-.51l-.58-.01c-.2 0-.52.08-.79.39-.27.31-1.04 1.02-1.04 2.49 0 1.46 1.07 2.88 1.22 3.08.16.2 2.11 3.22 5.11 4.5.71.31 1.26.5 1.69.64.71.22 1.36.19 1.88.12.58-.09 1.82-.74 2.08-1.45.26-.71.26-1.32.18-1.45-.08-.13-.28-.2-.58-.35zM16 3.2c-7.07 0-12.8 5.73-12.8 12.8 0 2.25.59 4.37 1.62 6.2L3.2 28.8l6.74-1.76c1.76.96 3.77 1.52 5.93 1.52 7.07 0 12.8-5.73 12.8-12.8S23.07 3.2 16 3.2zm0 22.94c-2.06 0-3.97-.62-5.57-1.68l-.4-.26-4 .99 1.06-3.9-.25-.4a10.97 10.97 0 0 1-1.68-5.59c0-6.07 4.93-11 11-11s11 4.93 11 11-4.93 11-11 11z" fill="#fff"/></svg>
      WhatsApp us
    </a>
  </div>
</section>

<script>
(function(){
  const DATA_URL = "/data/schedule.json?cb=" + Date.now();

  // DOM
  const $timeline = document.getElementById('timeline');
  const $skeleton = document.getElementById('skeleton');
  const $error = document.getElementById('error');
  const $empty = document.getElementById('empty');
  const $classChips = document.getElementById('class-chips');
  const $search = document.getElementById('search');
  const $up = document.getElementById('toggle-upcoming');
  const $past = document.getElementById('toggle-past');

  let rawItems = [];
  let activeClasses = new Set();
  let show = 'upcoming';
  let searchText = '';

  // Controls
  $up.addEventListener('click', ()=>{ show='upcoming'; $up.setAttribute('aria-pressed','true'); $past.setAttribute('aria-pressed','false'); draw(); });
  $past.addEventListener('click', ()=>{ show='past'; $past.setAttribute('aria-pressed','true'); $up.setAttribute('aria-pressed','false'); draw(); });
  $search.addEventListener('input', ()=>{ searchText = $search.value.trim(); draw(); });

  // Init
  (async function init(){
    try{
      const res = await fetch(DATA_URL, {cache:"no-store"});
      if(!res.ok) throw new Error('HTTP '+res.status);
      const items = await res.json();

      rawItems = (Array.isArray(items)?items:[])
        .map(x=>({
          date: normalizeDate(x.date),
          time: (x.time||"").toString().trim(),
          title: (x.title||"").toString().trim(),
          cls: (x.cls||"").toString().trim(),
          notes: (x.notes||"").toString().trim()
        }))
        .filter(x=> x.date && x.title);

      renderClassFilter(rawItems);
      $skeleton.hidden = true;
      $timeline.hidden = false;
      draw();
    }catch(e){
      console.error(e);
      $skeleton.hidden = true;
      $error.hidden = false;
    }
  })();

  /* ===== Helpers ===== */
  function parseLocalISO(d){
    d = (d||'').trim(); let dt;
    if(/^\d{4}-\d{1,2}-\d{1,2}$/.test(d)){ const [y,m,dd]=d.split('-').map(Number); dt=new Date(y,m-1,dd); }
    else if(/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(d)){ const [dd,m,y]=d.split('/').map(Number); dt=new Date(y,m-1,dd); }
    else { const t=new Date(d); dt=isNaN(t)?null:new Date(t.getFullYear(),t.getMonth(),t.getDate()); }
    return dt;
  }
  function normalizeDate(d){
    const dt = parseLocalISO(d); if(!dt) return "";
    return [dt.getFullYear(), String(dt.getMonth()+1).padStart(2,'0'), String(dt.getDate()).padStart(2,'0')].join('-');
  }
  function isToday(dt){ const n=new Date(); return dt && dt.getFullYear()===n.getFullYear() && dt.getMonth()===n.getMonth() && dt.getDate()===n.getDate(); }
  function fmtDate(dt){ return dt.toLocaleDateString(undefined,{weekday:'short', year:'numeric', month:'short', day:'numeric'}); }
  function monthKey(dt){ return dt.getFullYear() + '-' + String(dt.getMonth()+1).padStart(2,'0'); }
  function monthLabel(dt){ return dt.toLocaleDateString(undefined,{month:'long', year:'numeric'}); }
  function escapeHTML(s){ return (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  function renderClassFilter(items){
    const classes = Array.from(new Set(items.map(x => x.cls).filter(Boolean))).sort();
    $classChips.innerHTML = '';
    if(!classes.length) return;

    const lab = document.createElement('span');
    lab.className='subtitle';
    lab.style.marginRight='4px';
    lab.textContent='Filter:';
    $classChips.appendChild(lab);

    classes.forEach(cls=>{
      const chip = document.createElement('button');
      chip.className='chip'; chip.type='button'; chip.setAttribute('aria-pressed','false'); chip.textContent=cls;
      chip.addEventListener('click', ()=>{
        if(activeClasses.has(cls)) activeClasses.delete(cls); else activeClasses.add(cls);
        chip.setAttribute('aria-pressed', activeClasses.has(cls) ? 'true' : 'false');
        draw();
      });
      $classChips.appendChild(chip);
    });
  }

  function applyFilters(items){
    const now = new Date(); const today0 = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    return items.filter(it=>{
      const dt = parseLocalISO(it.date); if(!dt) return false;
      if(show==='upcoming' && dt < today0) return false;
      if(show==='past' && dt >= today0) return false;
      if(activeClasses.size && !activeClasses.has(it.cls)) return false;
      if(searchText){
        const q = searchText.toLowerCase();
        if(!(it.title.toLowerCase().includes(q) || (it.notes||'').toLowerCase().includes(q))) return false;
      }
      return true;
    });
  }

  function draw(){
    const items = applyFilters(rawItems).sort((a,b)=> parseLocalISO(a.date) - parseLocalISO(b.date));
    $timeline.innerHTML = '';
    if(!items.length){ $timeline.hidden = true; $empty.hidden = false; return; }
    $timeline.hidden = false; $empty.hidden = true;

    const listWrap = document.createElement('div'); listWrap.className='tl-list';
    const line = document.createElement('div'); line.className='tl-line'; listWrap.appendChild(line);

    let mk = '';
    items.forEach(it=>{
      const dt = parseLocalISO(it.date); const thisMk = monthKey(dt);
      if(thisMk !== mk){
        mk = thisMk;
        const m = document.createElement('div'); m.className='tl-month'; m.textContent = monthLabel(dt);
        $timeline.appendChild(m); $timeline.appendChild(listWrap);
      }

      const li = document.createElement('div');
      li.className = 'tl-item ' + (isToday(dt) ? 'today' : (dt < new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate()) ? 'past' : ''));

      const dateStr = fmtDate(dt);
      const timeStr = it.time ? `<span class="time-badge">${escapeHTML(it.time)}</span>` : '';

      li.innerHTML = `
        <div class="tl-dot" aria-hidden="true"></div>
        <div class="event">
          <div class="card-inner">
            <div class="date-bar">
              <span>${dateStr}</span>
              ${timeStr}
            </div>
            <div class="title">${escapeHTML(it.title)}</div>
            <div class="meta">${escapeHTML(it.cls || '')}</div>
            ${it.notes ? `<div class="note">${escapeHTML(it.notes)}</div>` : ``}
          </div>
        </div>`;
      listWrap.appendChild(li);
    });
  }
})();
</script>
</body>
</html>
