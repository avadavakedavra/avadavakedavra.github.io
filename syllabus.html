<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sehr Academy — Class 11 Syllabus (Completion Tracker)</title>
  <meta name="theme-color" content="#8BC53F" />
  <meta name="description" content="Class 11 syllabus completion tracker for Physics, Chemistry, Mathematics, Biology — filter by status, search by chapter, live dates." />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800;900&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --sehr-green:#8BC53F;
      --ink:#0F172A;
      --muted:#5b6475;
      --glass-border: rgba(255,255,255,0.55);
      --shadow: 0 20px 45px rgba(15,23,42,.12);
      --radius: 16px;
      --maxw:1180px;
      --frost-white: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.70));
      --frost-green: linear-gradient(180deg, rgba(214, 244, 190, .95), rgba(180, 232, 140, .78));
      --crystal: linear-gradient(180deg, rgba(255,255,255,.66), rgba(255,255,255,.30));
      --bar-gold: linear-gradient(90deg, #FBE7A1 0%, #F5C14A 50%, #D89A00 100%);
      --hint-bg: linear-gradient(180deg,#ffffff,#f5f7fb);
      --pill-bg: linear-gradient(180deg,#ffffff, rgba(255,255,255,.82));
    }
    *{box-sizing:border-box}
    html,body{margin:0}
    body{
      font-family: Nunito, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
      background: linear-gradient(180deg, #ffffff 0%, #fbfcfd 50%, #f7f8fa 100%);
      color:#111; line-height:1.65; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    /* Header (shared) */
    header{position:sticky;top:0;z-index:40;background:rgba(255,255,255,.78);border-bottom:1px solid rgba(230,232,236,.6);backdrop-filter:saturate(175%) blur(10px)}
    .container{max-width:var(--maxw);margin:0 auto;padding:0 20px}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
    .brand{display:flex;align-items:baseline;gap:8px;text-decoration:none}
    .brand span:nth-child(1){font-family:"Montserrat",sans-serif;font-weight:800;font-size:26px;color:var(--sehr-green);letter-spacing:.4px}
    .brand span:nth-child(2){font-family:"Montserrat",sans-serif;font-weight:800;font-size:26px;color:#0b0f10;letter-spacing:.4px}

    /* Page head */
    .pagehead{max-width:var(--maxw);margin:18px auto 12px;padding:0 20px;display:flex;align-items:flex-end;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .title{font-family:Montserrat;font-weight:900;font-size:26px;letter-spacing:.2px}
    .subtitle{color:#6b7280;font-weight:700}
    .stamp{font-family:Montserrat;font-weight:800;font-size:12px;color:#2b3345;opacity:.85}

    /* Controls: filter tabs + search */
    .controls{max-width:var(--maxw);margin:10px auto 0;padding:0 20px;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:1px solid var(--glass-border); background:linear-gradient(180deg,#fff,rgba(255,255,255,.8));font-weight:800; cursor:pointer; user-select:none}
    .chip:hover{filter:brightness(1.03)}
    .chip[aria-pressed="true"]{outline:2px solid rgba(139,197,63,.45); box-shadow:0 6px 16px rgba(139,197,63,.18)}
    .search{flex:1; min-width:240px; display:flex; align-items:center; gap:8px; background:var(--hint-bg); border:1px solid var(--glass-border); border-radius:12px; padding:8px 12px}
    .search input{border:0;background:transparent;outline:none;flex:1;font-weight:700}

    /* Legend */
    .panel{max-width:var(--maxw); margin:10px auto 0; padding:16px 20px; border-radius:var(--radius);
      border:1px solid var(--glass-border); background:var(--frost-white); box-shadow:var(--shadow);}
    .legend{display:flex;gap:12px;flex-wrap:wrap;font-weight:700;color:#334}
    .dot{width:10px;height:10px;border-radius:999px;background:#cfd6df}
    .dot.pending{background:#cfd6df}
    .dot.ongoing{background:#f6c761}
    .dot.completed{background:#69c04c}

    /* Subject accordions (highlighted summaries) */
    details.group{max-width:var(--maxw); margin:14px auto; border-radius:16px; border:1px solid var(--glass-border);
      background:var(--frost-white); box-shadow:var(--shadow); overflow:hidden}
    details.group > summary{
      list-style:none; cursor:pointer; padding:16px 18px; user-select:none; display:grid;
      grid-template-columns: 1fr auto; align-items:center; gap:10px;
      font-family:Montserrat; font-weight:900; font-size:18px;
      background:linear-gradient(180deg,#ffffff, #f2f6f1);
      border-bottom:1px solid rgba(230,232,236,.6);
      transition: transform .15s ease, box-shadow .15s ease, filter .15s ease;
      position:relative;
    }
    details.group > summary::-webkit-details-marker{display:none}
    details.group > summary:hover{
      transform: translateY(-1px);
      box-shadow:0 10px 24px rgba(139,197,63,.18);
      filter: drop-shadow(0 0 6px rgba(139,197,63,.12));
    }
    .sum-left{display:flex;align-items:center;gap:12px}
    .subject-name{font-size:18px; color:#0b0f10; text-transform:uppercase; letter-spacing:.4px}

    /* Click hint to far right (no arrows) */
    .sum-right{display:flex; align-items:center; gap:14px}
    .hint{
      font-family:Montserrat; font-weight:800; font-size:11px; text-transform:uppercase; letter-spacing:.5px;
      color:#2b3345; opacity:.78; background:var(--hint-bg); border:1px solid var(--glass-border); border-radius:999px; padding:6px 10px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.6);
    }
    .hint-open{display:none}
    details[open] .hint-open{display:inline}
    details[open] .hint-closed{display:none}

    /* Progress mini bar inside summary (gold gradient) */
    .prog-wrap{width:220px; display:flex; flex-direction:column; gap:4px}
    .prog-rail{width:100%; height:8px; border-radius:999px; background:rgba(0,0,0,.06); position:relative; overflow:hidden; border:1px solid rgba(0,0,0,.06)}
    .prog-fill{height:100%; width:0%; background:var(--bar-gold); border-radius:999px; transition:width .45s ease}
    .prog-note{font-size:10px; font-weight:900; color:#2b3345; text-transform:uppercase; letter-spacing:.4px; opacity:.8; text-align:right}

    /* Chapter list — square & crystal glass */
    .chapters{padding:8px 16px 18px 16px; display:grid; gap:10px}
    .row{
      display:grid; grid-template-columns: 1fr auto auto; gap:12px; align-items:center;
      padding:14px 14px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.55);
      background:var(--crystal);
      backdrop-filter: blur(9px) saturate(160%);
      -webkit-backdrop-filter: blur(9px) saturate(160%);
      box-shadow:0 10px 28px rgba(15,23,42,.10), inset 0 1px 0 rgba(255,255,255,.45);
      transition:transform .18s ease, box-shadow .18s ease, filter .18s ease, border-color .18s ease;
    }
    .row:hover{
      transform:translateY(-2px);
      box-shadow:0 16px 36px rgba(15,23,42,.14), inset 0 1px 0 rgba(255,255,255,.55);
      border-color:rgba(255,255,255,.75);
      filter:drop-shadow(0 0 6px rgba(139,197,63,.18));
    }
    .row.completed{
      background: var(--frost-green);
      border-color: rgba(139,197,63,.55);
      box-shadow:0 12px 30px rgba(139,197,63,.18), inset 0 1px 0 rgba(255,255,255,.6);
    }
    .row .name{font-weight:800}

    /* Square status & date pills (date is frosty white) */
    .status, .date{
      font-family:Montserrat; font-weight:900; font-size:12px; padding:6px 8px;
      border-radius:8px; border:1px solid var(--glass-border);
      min-width:96px; text-align:center; letter-spacing:.3px;
    }
    .status{ text-transform:uppercase; background:var(--pill-bg); color:#334 }
    .status.ongoing{background:linear-gradient(180deg,#fff7e6,#fff4d6)}
    .status.completed{background:linear-gradient(180deg,#e8fadf,#d9f7c7); color:#0a5a1a; border-color:rgba(139,197,63,.55)}
    .date{ background:var(--pill-bg); color:#2b3345 }
    .date:empty{ display:none } /* hide empty date cells */

    /* Footer */
    footer{max-width:var(--maxw); margin:28px auto 40px; padding:0 20px; display:none}

    /* Compact mobile density */
    @media (max-width: 380px){
      .row{padding:10px}
      .prog-wrap{width:160px}
      details.group > summary{grid-template-columns: 1fr; gap:8px}
      .sum-right{justify-content:space-between}
    }
  </style>
</head>
<body>
  <!-- Shared header -->
  <header id="site-header"></header>
  <script src="/assets/nav.js" defer></script>

  <div class="pagehead">
    <div>
      <div class="title">Class 11 Syllabus — Completion Tracker</div>
      <div class="subtitle">Filter by status, search chapters, and view live completion.</div>
      <div class="stamp" id="last-updated"></div>
    </div>
  </div>

  <!-- Controls -->
  <div class="controls">
    <div id="filters" role="tablist" aria-label="Filter chapters by status">
      <button data-filter="all" class="chip" aria-pressed="true">All</button>
      <button data-filter="pending" class="chip" aria-pressed="false">Pending</button>
      <button data-filter="ongoing" class="chip" aria-pressed="false">Ongoing</button>
      <button data-filter="completed" class="chip" aria-pressed="false">Completed</button>
    </div>

    <!-- NEW: Collapse All -->
    <button id="btn-collapse-all" class="chip" type="button" title="Collapse all subjects">Collapse All</button>

    <div class="search" role="search">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.2-4.2M10.8 18a7.2 7.2 0 1 1 0-14.4 7.2 7.2 0 0 1 0 14.4Z" stroke="#2b3345" stroke-width="2" stroke-linecap="round"/></svg>
      <input id="search" type="search" placeholder="Search chapters…" aria-label="Search chapters by name" />
    </div>
  </div>

  <!-- Legend -->
  <section class="panel" aria-label="Legend">
    <div class="legend">
      <span class="chip"><span class="dot pending"></span> Pending</span>
      <span class="chip"><span class="dot ongoing"></span> Ongoing</span>
      <span class="chip"><span class="dot completed"></span> Completed</span>
    </div>
  </section>

  <!-- Subjects (closed by default) -->
  <details class="group" data-subject="physics">
    <summary>
      <span class="sum-left">
        <span class="subject-name">Physics</span>
      </span>
      <span class="sum-right">
        <span class="prog-wrap">
          <span class="prog-rail"><span class="prog-fill" id="bar-physics"></span></span>
          <span class="prog-note" id="note-physics">0/0</span>
        </span>
        <span>
          <span class="hint hint-closed">Click to open</span>
          <span class="hint hint-open">Click to close</span>
        </span>
      </span>
    </summary>
    <div class="chapters" id="list-physics"></div>
  </details>

  <details class="group" data-subject="chemistry">
    <summary>
      <span class="sum-left">
        <span class="subject-name">Chemistry</span>
      </span>
      <span class="sum-right">
        <span class="prog-wrap">
          <span class="prog-rail"><span class="prog-fill" id="bar-chemistry"></span></span>
          <span class="prog-note" id="note-chemistry">0/0</span>
        </span>
        <span>
          <span class="hint hint-closed">Click to open</span>
          <span class="hint hint-open">Click to close</span>
        </span>
      </span>
    </summary>
    <div class="chapters" id="list-chemistry"></div>
  </details>

  <details class="group" data-subject="mathematics">
    <summary>
      <span class="sum-left">
        <span class="subject-name">Mathematics</span>
      </span>
      <span class="sum-right">
        <span class="prog-wrap">
          <span class="prog-rail"><span class="prog-fill" id="bar-mathematics"></span></span>
          <span class="prog-note" id="note-mathematics">0/0</span>
        </span>
        <span>
          <span class="hint hint-closed">Click to open</span>
          <span class="hint hint-open">Click to close</span>
        </span>
      </span>
    </summary>
    <div class="chapters" id="list-mathematics"></div>
  </details>

  <!-- Biology split into two separate dropdowns -->
  <details class="group" data-subject="botany">
    <summary>
      <span class="sum-left">
        <span class="subject-name">Biology — Botany</span>
      </span>
      <span class="sum-right">
        <span class="prog-wrap">
          <span class="prog-rail"><span class="prog-fill" id="bar-botany"></span></span>
          <span class="prog-note" id="note-botany">0/0</span>
        </span>
        <span>
          <span class="hint hint-closed">Click to open</span>
          <span class="hint hint-open">Click to close</span>
        </span>
      </span>
    </summary>
    <div class="chapters" id="list-botany"></div>
  </details>

  <details class="group" data-subject="zoology">
    <summary>
      <span class="sum-left">
        <span class="subject-name">Biology — Zoology</span>
      </span>
      <span class="sum-right">
        <span class="prog-wrap">
          <span class="prog-rail"><span class="prog-fill" id="bar-zoology"></span></span>
          <span class="prog-note" id="note-zoology">0/0</span>
        </span>
        <span>
          <span class="hint hint-closed">Click to open</span>
          <span class="hint hint-open">Click to close</span>
        </span>
      </span>
    </summary>
    <div class="chapters" id="list-zoology"></div>
  </details>

  <!-- Footer hidden (per your request) -->
  <footer></footer>

  <script>
    /* ====== Data fetching (robust path resolver) ====== */
    const CANDIDATES = [
      new URL('./data/syllabus.json?cb=' + Date.now(), location.href).toString(),
      new URL('data/syllabus.json?cb=' + Date.now(), location.href).toString(),
      location.origin + '/data/syllabus.json?cb=' + Date.now()
    ];
    async function fetchFirst(paths){
      for(const p of paths){
        try{
          const r = await fetch(p, {cache:'no-store'});
          if(r.ok) return { res: r, url: p };
        }catch(e){}
      }
      throw new Error('None of the candidate paths worked:\n' + paths.join('\n'));
    }

    /* ====== Refs ====== */
    const lists = {
      physics: document.getElementById('list-physics'),
      chemistry: document.getElementById('list-chemistry'),
      mathematics: document.getElementById('list-mathematics'),
      botany: document.getElementById('list-botany'),
      zoology: document.getElementById('list-zoology')
    };
    const bars = {
      physics: document.getElementById('bar-physics'),
      chemistry: document.getElementById('bar-chemistry'),
      mathematics: document.getElementById('bar-mathematics'),
      botany: document.getElementById('bar-botany'),
      zoology: document.getElementById('bar-zoology')
    };
    const notes = {
      physics: document.getElementById('note-physics'),
      chemistry: document.getElementById('note-chemistry'),
      mathematics: document.getElementById('note-mathematics'),
      botany: document.getElementById('note-botany'),
      zoology: document.getElementById('note-zoology')
    };
    const lastUpdatedEl = document.getElementById('last-updated');

    /* ====== Utilities ====== */
    function fmtDayMonth(s){
      if(!s) return '';
      const d = new Date(s);
      if(isNaN(d)) return '';
      const day = d.getDate().toString().padStart(2,'0');
      const mon = d.toLocaleString('en-GB',{month:'short'});
      return `${day} ${mon}`;
    }

    function makeRow(item){
      const div = document.createElement('div');
      const st = (item.status || 'pending').toLowerCase();
      const when = fmtDayMonth(item.expectedDate || '');
      div.className = 'row ' + (st==='completed' ? 'completed' : '');
      div.dataset.status = st;
      div.dataset.name = (item.title || '').toLowerCase();

      const dateHTML = when ? `<div class="date">${when}</div>` : `<div class="date"></div>`;
      div.innerHTML = `
        <div class="name">${item.index ? (item.index + '. ') : ''}${item.title}</div>
        <div class="status ${st}">${st.toUpperCase()}</div>
        ${dateHTML}
      `;
      return div;
    }

    // Smooth & reliable progress animation; ensures width is applied after layout.
    function setProgress(total, done, key){
      const bar = bars[key];
      const note = notes[key];
      if(!bar || !note) return;
      const pct = total ? Math.round((done/total)*100) : 0;
      bar.style.width = '0%';
      requestAnimationFrame(()=>{ bar.style.width = pct + '%'; });
      note.textContent = `${done}/${total}`;
    }

    function renderSimple(arr, mount, key){
      mount.innerHTML = '';
      const sorted = [...arr].sort((a,b)=>(a.index||999)-(b.index||999));
      let done = 0;
      sorted.forEach(ch => {
        if((ch.status||'').toLowerCase()==='completed') done++;
        mount.appendChild(makeRow(ch));
      });
      setProgress(sorted.length, done, key);
    }

    function renderBioStreams(bio){
      const botany = (bio || []).filter(x => (x.stream||'').toLowerCase()==='botany');
      const zoology = (bio || []).filter(x => (x.stream||'').toLowerCase()==='zoology');

      // Botany
      lists.botany.innerHTML = '';
      let doneB=0;
      botany.sort((a,b)=>(a.index||999)-(b.index||999)).forEach(ch=>{
        if((ch.status||'').toLowerCase()==='completed') doneB++;
        lists.botany.appendChild(makeRow(ch));
      });
      setProgress(botany.length, doneB, 'botany');

      // Zoology
      lists.zoology.innerHTML = '';
      let doneZ=0;
      zoology.sort((a,b)=>(a.index||999)-(b.index||999)).forEach(ch=>{
        if((ch.status||'').toLowerCase()==='completed') doneZ++;
        lists.zoology.appendChild(makeRow(ch));
      });
      setProgress(zoology.length, doneZ, 'zoology');
    }

    /* ====== Filters & Search ====== */
    const filterState = { value:'all', query:'' };

    function applyFilters(){
      const rows = document.querySelectorAll('.chapters .row');
      rows.forEach(r=>{
        const st = r.dataset.status;
        const name = r.dataset.name || '';
        const statusMatch = (filterState.value==='all' || st===filterState.value);
        const textMatch = (!filterState.query || name.includes(filterState.query));
        r.style.display = (statusMatch && textMatch) ? '' : 'none';
      });
    }

    document.getElementById('filters').addEventListener('click', e=>{
      if(e.target.matches('button[data-filter]')){
        filterState.value = e.target.dataset.filter;
        [...e.currentTarget.querySelectorAll('button')].forEach(b=>b.setAttribute('aria-pressed', String(b===e.target)));
        applyFilters();
      }
    });

    document.getElementById('search').addEventListener('input', e=>{
      filterState.query = (e.target.value || '').toLowerCase().trim();
      applyFilters();
    });

    /* ====== NEW: Collapse All handler ====== */
    document.getElementById('btn-collapse-all').addEventListener('click', ()=>{
      document.querySelectorAll('details.group[open]').forEach(d=> d.open = false);
    });

    /* ====== Init ====== */
    async function init(){
      try{
        const { res } = await fetchFirst(CANDIDATES);
        const data = await res.json();

        // Last updated stamp
        if (data.meta && data.meta.lastUpdated){
          const d = new Date(data.meta.lastUpdated);
          if (!isNaN(d)){
            lastUpdatedEl.textContent = 'Last updated: ' + d.toLocaleString('en-IN', { day:'2-digit', month:'short', hour:'2-digit', minute:'2-digit' });
          }
        }

        renderSimple(data.physics || [], lists.physics, 'physics');
        renderSimple(data.chemistry || [], lists.chemistry, 'chemistry');
        renderSimple(data.mathematics || [], lists.mathematics, 'mathematics');
        renderBioStreams(data.biology || []);

        // Ensure closed by default
        document.querySelectorAll('details.group').forEach(d => d.open = false);

        // Apply filters once rendered
        applyFilters();
      }catch(err){
        console.error('Failed to load syllabus.json', err);
        // graceful placeholder
        Object.values(lists).forEach(m=>{
          const d = document.createElement('div');
          d.className='row';
          d.innerHTML = '<div class="name">Couldn’t load <code>/data/syllabus.json</code>.</div><div class="status">ERROR</div><div class="date"></div>';
          m.appendChild(d);
        });
      }
    }
    init();
  </script>
</body>
</html>
