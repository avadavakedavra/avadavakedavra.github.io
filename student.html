<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SEHR Academy Premium Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

<style>
:root{
  --lime:#8BC53F;
  --bg:#f5f7f4;
  --dark:#1f2937;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Montserrat,sans-serif;
  background:var(--bg);
  color:var(--dark);
}

.dashboard-wrapper{
  display:flex;
}


.sidebar{
  width:260px;
  min-height:100vh;
  padding:35px 22px;
  position:fixed;
  overflow:hidden;

  /* Frosted glass effect */
  background:rgba(139,197,63,0.75);
  backdrop-filter:blur(18px);
  -webkit-backdrop-filter:blur(18px);

  /* Subtle glass border */
  border-right:1px solid rgba(255,255,255,0.25);

  /* Soft shadow depth */
  box-shadow:4px 0 30px rgba(0,0,0,0.08);

  color: #ffffff;
}
/* Abstract modern pattern */
.sidebar::before{
  content:"";
  position:absolute;
  width:400px;
  height:400px;
  background:radial-gradient(circle at 30% 30%, rgba(255,255,255,0.35), transparent 60%);
  top:-100px;
  left:-120px;
  z-index:0;
}

.sidebar::after{
  content:"";
  position:absolute;
  width:300px;
  height:300px;
  background:radial-gradient(circle at 70% 70%, rgba(255,255,255,0.2), transparent 70%);
  bottom:-120px;
  right:-80px;
  z-index:0;
}
.sidebar > *{
  position:relative;
  z-index:2;
}
.sidebar h2{
  font-family:'Playfair Display', serif;
  font-weight:700;
  color:#ffffff;
  text-shadow:0 3px 10px rgba(0,0,0,0.35);
}

#sideClass{
  color:rgba(255,255,255,0.85);
  font-weight:500;
  letter-spacing:0.5px;
}

.menu-item{
  font-weight:700;
  color:#ffffff;
  text-shadow:0 2px 8px rgba(0,0,0,0.3);
}
.profile-side{text-align:center;margin-bottom:40px;}
.profile-side img{
  width:150px;
  height:150px;
  border-radius:50%;
  object-fit:cover;
  border:4px solid rgba(255,255,255,0.9);
  box-shadow:0 8px 25px rgba(0,0,0,0.2);
}
.profile-side h2{
  font-family:'Playfair Display',serif;
  margin:15px 0 5px;
}
.menu-item{
  padding:12px 14px;
  border-radius:12px;
  cursor:pointer;
  margin-bottom:8px;
  font-weight:600;
  letter-spacing:0.3px;
  transition:all .25s ease;
  border-left:3px solid transparent;
  padding-left:14px;
}


.menu-item:hover{
  background:rgba(255,255,255,0.25);
  backdrop-filter:blur(8px);
}

.menu-item.active{
  background:#111827;        /* deep charcoal, not pure black */
  color:#ffffff;
  box-shadow:none;
  border-left:3px solid white;
}
.menu-item:not(.active){
  opacity:0.9;
}
.main{
  margin-left:260px;
  padding:60px 60px;
  width:100%;
}
.card{
  background:white;
  padding:30px;
  border:1px solid #f1f5f9;
  border-radius:20px;
  box-shadow:0 10px 30px rgba(0,0,0,.06);
  margin-bottom:35px;
  transition:all 0.3s ease;
}

.card:hover{
  transform:translateY(-6px);
  box-shadow:0 18px 45px rgba(0,0,0,0.08);
}
.section{display:none;}
.section.active{display:block;}
.badge{
  background:var(--lime);
  color:white;padding:6px 14px;
  border-radius:20px;
}
.info-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:25px;
}
.info-box{
  background:#f9fafb;
  padding:18px 20px;
  border-radius:14px;
}
.info-label{
  font-size:13px;color:#6b7280;
  margin-bottom:8px;text-transform:uppercase;
}
.info-value{font-size:20px;font-weight:800;}
.subject-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:18px;margin-top:20px;
}
.subject-card{
  background:#fff;padding:18px;
  border-radius:16px;
  box-shadow:0 5px 15px rgba(0,0,0,.05);
}
.subject-score{font-size:24px;font-weight:800;}
.progress-bar{
  height:10px;background:#eee;
  border-radius:999px;overflow:hidden;
  margin-top:8px;
}
.progress-fill{
  height:100%;
  border-radius:999px;
  transition:width 0.8s ease-in-out;
}
h2{
  font-family:'Playfair Display', serif;
  font-weight:700;
  letter-spacing:0.5px;
  font-size:24px;
}
.year-select{
  padding:8px 14px;
  border-radius:8px;
  border:1px solid #ddd;
  font-weight:600;
}
.loader{
  position:fixed;
  inset:0;
  background:rgba(255,255,255,0.7);
  backdrop-filter:blur(4px);
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  font-size:18px;
  z-index:9999;
  opacity:0;
  pointer-events:none;
  transition:opacity 0.3s ease;
}

.loader.active{
  opacity:1;
  pointer-events:all;
}
.portal-header{
  margin-bottom:40px;
}

.portal-title{
  font-family:'Playfair Display', serif;
  font-size:26px;
  font-weight:700;
  letter-spacing:0.5px;
}

.portal-sub{
  color:#6b7280;
  font-size:14px;
  margin-top:4px;
}
.status-paid{color:#16a34a;font-weight:700;}
.status-pending{color:#dc2626;font-weight:700;}
.status-partial{color:#f59e0b;font-weight:700;}
</style>
</head>

<body>
  <header id="site-header"></header>
<script src="/assets/nav.js" defer></script>
<div id="loader" class="loader">
  Loading...
</div>
  <div class="dashboard-wrapper">
<div class="sidebar">
  <div class="profile-side">
    <img id="sidePhoto">
    <h2 id="sideName"></h2>
    <div id="sideClass"></div>
  </div>
  <div class="menu-item active" onclick="showSection(event,'overview')">Overview</div>
  <div class="menu-item" onclick="showSection(event,'results')">Results</div>
  <div class="menu-item" onclick="showSection(event,'attendance')">Attendance</div>
  <div class="menu-item" onclick="showSection(event,'fees')">Fees</div>
  <div class="menu-item" onclick="showSection(event,'remarks')">Remarks</div>
  <div class="menu-item" onclick="showSection(event,'achievements')">Achievements</div>
</div>

<div class="main">
<div class="portal-header">
  <div class="portal-title">SEHR Academic Performance Portal</div>
  <div class="portal-sub">Student Analytics Dashboard</div>
</div>
<!-- OVERVIEW -->
<div id="overview" class="section active">
  <div class="card">
    <h2 id="studentName"></h2>
    <div class="info-grid">
      <div class="info-box">
        <div class="info-label">Rank</div>
        <div class="badge" id="rank"></div>
      </div>
      <div class="info-box">
        <div class="info-label">Final Exam Score</div>
        <div class="info-value"><b id="overall"></b></div>
      </div>
      <div class="info-box">
        <div class="info-label">Syllabus</div>
        <div class="info-value" id="syllabusDisplay"></div>
      </div>
      <div class="info-box">
        <div class="info-label">Age</div>
        <div class="info-value" id="ageDisplay"></div>
      </div>
      <div class="info-box">
        <div class="info-label">Course Duration Remaining</div>
        <div class="info-value" id="courseRemaining"></div>
      </div>
    </div>
  </div>
</div>

<!-- RESULTS -->
<div id="results" class="section">
  <div class="card">
    <h2>Results</h2>
    Academic Year:
    <select id="yearSelect" class="year-select"></select>
    <div id="subjectBoxes" class="subject-grid"></div>
    <div id="majorExamSection"></div>
  </div>
</div>

<!-- ATTENDANCE -->
<div id="attendance" class="section">
  <div class="card">
    <h2>Attendance</h2>
    <div class="info-grid">
      <div class="info-box">
        <div class="info-label">Total Classes</div>
        <div class="info-value" id="totalClasses"></div>
      </div>
      <div class="info-box">
        <div class="info-label">Attended</div>
        <div class="info-value" id="attendedClasses"></div>
      </div>
      <div class="info-box">
        <div class="info-label">Attendance %</div>
        <div class="info-value" id="attendancePercent"></div>
      </div>
    </div>
  </div>
</div>

<!-- FEES -->
<div id="fees" class="section">
  <div class="card">
    <h2>Fee Schedule</h2>
    <div id="feeDetails"></div>
  </div>
</div>

<!-- REMARKS -->
<div id="remarks" class="section">
  <div class="card">
    <h2>Remarks</h2>
    <div id="remarksList"></div>
  </div>
</div>

<!-- ACHIEVEMENTS -->
<div id="achievements" class="section">
  <div class="card">
    <h2>Achievements</h2>
    <div id="achievementList"></div>
  </div>
</div>
</div> <!-- closes dashboard-wrapper -->
</div>

<script>

const API="https://script.google.com/macros/s/AKfycbzudeZ677Mxp0KZGtILfVVBk0cB4V2zwpXrpqtemE4cHt7Sp7_Vc6U3_shwcpYmB15vRA/exec";

let globalData=null;

function getId(){
  return new URL(window.location.href).searchParams.get("id");
}

function calculateAge(birthday){
  const birth=new Date(birthday);
  const today=new Date();
  let years=today.getFullYear()-birth.getFullYear();
  let months=today.getMonth()-birth.getMonth();
  if(months<0){years--;months+=12;}
  return `${years} Years ${months} Months`;
}

function calculateRemainingDays(){
  const today=new Date();
  let year=today.getFullYear();
  if(today.getMonth()>2){year+=1;}
  const end=new Date(year,2,31);
  const diff=end-today;
  if(diff<=0)return"Completed";
  return `${Math.ceil(diff/(1000*60*60*24))} Days Remaining`;
}

async function load(){
  document.getElementById("loader").classList.add("active");  const id=getId();
  const res=await fetch(API+"?id="+id);
  const data=await res.json();
  globalData=data;

  document.getElementById("studentName").innerText=data.student.full_name;
  document.getElementById("sideName").innerText=data.student.full_name;
  document.getElementById("sideClass").innerText="Class "+data.student.class;
  document.getElementById("sidePhoto").src=data.student.photo;
  document.getElementById("rank").innerText=data.analytics.rank;

  // FINAL EXAM ONLY
  if(data.analytics.final_average && data.analytics.final_average>0){
    document.getElementById("overall").innerText=data.analytics.final_average+"%";
  }else{
    document.getElementById("overall").innerText="NA";
  }

  document.getElementById("syllabusDisplay").innerText=data.student.syllabus;
  document.getElementById("ageDisplay").innerText=calculateAge(data.student.birthday);
  document.getElementById("courseRemaining").innerText=calculateRemainingDays();

  // Attendance
  document.getElementById("totalClasses").innerText=data.attendance.total_classes;
  document.getElementById("attendedClasses").innerText=data.attendance.attended;
const percent=data.attendance.percentage;
let label="";
let color="";

if(percent>=95){
  label="Excellent";
  color="#16a34a";
}else if(percent>=85){
  label="Good";
  color="#ca8a04";
}else{
  label="Needs Attention";
  color="#dc2626";
}

document.getElementById("attendancePercent").innerHTML=
  `<span style="color:${color};font-weight:800;">
    ${percent}% – ${label}
  </span>`;

  // Fees
  buildFees();

// Remarks
if(data.remarks && data.remarks.length > 0){

  document.getElementById("remarksList").innerHTML =
    data.remarks.map(r => `
<div style="margin-bottom:16px;padding-bottom:10px;border-bottom:1px solid #f1f5f9;">
        <b>${new Date(r.date).toLocaleDateString()}</b><br>
        ${r.remark}
      </div>
    `).join("");

}else{

  document.getElementById("remarksList").innerHTML =
`<div style="color:#9ca3af;font-weight:500;text-align:center;padding:20px 0;">
       No remarks added yet.
     </div>`;

}

// Achievements
if(data.achievements && data.achievements.length > 0){

  document.getElementById("achievementList").innerHTML =
    data.achievements.map(a => `
      <div style="margin-bottom:12px;">
        <b>${a.title}</b><br>
        ${a.description}
      </div>
    `).join("");

}else{

  document.getElementById("achievementList").innerHTML =
    `<div style="color:#9ca3af;font-weight:500;text-align:center;padding:20px 0;">
       No achievements added yet.
     </div>`;

}
document.getElementById("loader").classList.remove("active");
  setupYearDropdown();
}

function buildFees(){

  const container=document.getElementById("feeDetails");

  const terms=[
    {
      name:"Term 1",
      percent:"33%",
      months:"4 Month Fee",
      due:"1 March"
    },
    {
      name:"Term 2",
      percent:"33%",
      months:"4 Month Fee",
      due:"1 June"
    },
    {
      name:"Term 3",
      percent:"33%",
      months:"4 Month Fee",
      due:"1 September"
    }
  ];

  container.innerHTML=terms.map(t=>`
    <div class="subject-card" style="margin-bottom:20px;">
      <h3>${t.name}</h3>

      <div style="margin-top:6px;color:#6b7280;">
        ${t.percent} of Total Fee • ${t.months}
      </div>

      <div style="margin-top:10px;">
        Due Date: ${t.due}
      </div>
    </div>
  `).join("");
}
function setupYearDropdown(){
  const years=globalData.available_years||[];
  const select=document.getElementById("yearSelect");
  select.innerHTML=years.map(y=>`<option value="${y}">${y}</option>`).join("");
  select.value=globalData.academic_year;
  select.addEventListener("change",()=>loadYear(select.value));
  loadYear(select.value);
}

async function loadYear(year){
  const id=getId();
  const res=await fetch(API+"?id="+id+"&year="+year);
  const data=await res.json();
  globalData=data;
  buildResults();
}

function buildResults(){
  const subjects=["Physics","Chemistry","Mathematics","Biology"];
  const subjectBox=document.getElementById("subjectBoxes");
  subjectBox.innerHTML="";

  subjects.forEach(sub=>{
    const scores=globalData.monthly_exams.filter(x=>x.subject===sub)
      .map(x=>Number(x.percentage));
    const avg=scores.length?scores.reduce((a,b)=>a+b,0)/scores.length:0;

    subjectBox.innerHTML+=`
      <div class="subject-card">
        <h4>${sub}</h4>
        <div class="subject-score">${avg.toFixed(1)}%</div>
        <div class="progress-bar">
          <div class="progress-fill" style="width:${avg}%;background:${getGradient(avg)}"></div>
        </div>
      </div>`;
  });

  document.getElementById("majorExamSection").innerHTML=
    `<h2 style="margin-top:30px;">Sehr Academy Exams</h2>
     ${buildExamSections(globalData.sehr_major_exams)}
     <h2 style="margin-top:40px;">School Exams</h2>
     ${buildExamSections(globalData.school_exams)}`;
}

function buildExamSections(exams){
  const map={
    first_term:"First Terminal Examination - August",
    second_term:"Second Terminal Examination - December",
    model:"Model Examination - February",
    final:"Final Examination"
  };
  return Object.keys(map).map(key=>{
    const filtered=exams.filter(e=>e.exam_type===key);
    if(!filtered.length)return"";
    return `<h3 style="margin-top:20px;">${map[key]}</h3>${buildMajorBoxes(filtered)}`;
  }).join("");
}

function buildMajorBoxes(exams){
  const subjects=["Physics","Chemistry","Mathematics","Biology"];
  return `<div class="subject-grid">${
    subjects.map(sub=>{
      const subExams=exams.filter(e=>e.subject===sub);
      const avg=subExams.length?subExams.reduce((a,b)=>a+Number(b.percentage),0)/subExams.length:0;
      return `<div class="subject-card">
        <h4>${sub}</h4>
        <div class="subject-score">${avg.toFixed(1)}%</div>
        <div class="progress-bar">
          <div class="progress-fill" style="width:${avg}%;background:${getGradient(avg)}"></div>
        </div>
      </div>`;
    }).join("")
  }</div>`;
}

function getGradient(score){
  if(score<50)return"linear-gradient(90deg,#ef4444,#dc2626)";
  if(score<75)return"linear-gradient(90deg,#f59e0b,#fbbf24)";
  if(score<90)return"linear-gradient(90deg,#eab308,#ca8a04)";
  return"linear-gradient(90deg,#8BC53F,#65a30d)";
}

function showSection(e,id){
  document.querySelectorAll(".menu-item").forEach(m=>m.classList.remove("active"));
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  e.target.classList.add("active");
  document.getElementById(id).classList.add("active");
}

load();

</script>
</body>
</html>
