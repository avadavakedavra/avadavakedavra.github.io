<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sehr Academy â€” Study Dashboard</title>

<!-- Fonts (same as student login) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800;900&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --sehr-green:#8BC53F;
  --ink:#0F172A;
  --muted:#5b6475;
  --border:rgba(230,232,236,.6);
  --glass:linear-gradient(180deg,rgba(255,255,255,.96),rgba(255,255,255,.8));
  --shadow:0 20px 45px rgba(15,23,42,.12);
  --radius:22px;
  --maxw:1180px;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:Nunito,system-ui;
  background:linear-gradient(180deg,#ffffff,#f7f8fa);
  color:var(--ink);
}

/* ===== NAVBAR (same as student login) ===== */
header{
  position:sticky;top:0;z-index:40;
  background:rgba(255,255,255,.78);
  border-bottom:1px solid var(--border);
  backdrop-filter:blur(10px);
}
.container{max-width:var(--maxw);margin:auto;padding:0 20px}
.nav{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
.brand{display:flex;gap:6px;font-family:Montserrat;font-weight:900;font-size:26px}
.brand span:first-child{color:var(--sehr-green)}

main{max-width:var(--maxw);margin:30px auto;padding:0 20px}

/* ===== Controls ===== */
select{
  padding:12px 14px;
  border-radius:14px;
  border:1px solid var(--border);
  font-weight:700;
}

/* ===== Cards ===== */
.card{
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:20px;
  box-shadow:var(--shadow);
  margin-bottom:24px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
  gap:24px;
}

.chapter{
  border-left:4px solid #e5e7eb;
  padding-left:12px;
  margin-bottom:12px;
}

.subject{
  font-size:12px;
  font-weight:800;
  text-transform:uppercase;
  color:var(--muted);
}

.status{
  font-size:11px;
  font-weight:800;
  padding:4px 10px;
  border-radius:999px;
  display:inline-block;
  margin-top:6px;
}
.completed{background:#dcfce7;color:#166534}
.pending{background:#ffffff;border:1px solid #e5e7eb}

/* ===== Speedometer ===== */
.tracker-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:24px;
}

.gauge{
  width:180px;
  margin:auto;
  position:relative;
}
.gauge svg{width:100%}
.bg{stroke:#e5e7eb;stroke-width:14;fill:none}
.progress{
  stroke:var(--sehr-green);
  stroke-width:14;
  fill:none;
  stroke-linecap:round;
  stroke-dasharray:251;
  stroke-dashoffset:251;
  transition:stroke-dashoffset 1s ease;
}
.percent{
  position:absolute;
  bottom:0;
  left:50%;
  transform:translateX(-50%);
  font-family:Montserrat;
  font-weight:900;
  font-size:22px;
}
</style>
</head>

<body>

<header>
  <div class="container nav">
    <div class="brand"><span>SEHR</span><span>ACADEMY</span></div>
    <div style="font-weight:700">Student Dashboard</div>
  </div>
</header>

<main>

<div class="card">
  <label style="font-weight:800">Select Student</label><br>
  <select id="studentSelect">
    <option value="">Select</option>
  </select>
</div>

<h2 style="font-family:Montserrat">Daily Study Plan</h2>
<div class="grid" id="days"></div>

<h2 style="font-family:Montserrat;margin-top:50px">Subject Progress</h2>
<div class="tracker-grid" id="trackers"></div>

</main>

<script>
const API_URL = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLjF9cHXk96gY7A66x-KNDIPOS6YC-zyVSV2f4PEx1tCCQruYGxMjGtoRH0Jz-z87CizRfCPypL802aXHqN44n2miYngScxqZDRPdoNvXzDseHLb8jGiBiBN_xqMEbFlBsuBrwLnxBNf_XvBQrDh-y668g33f_RcJu_8lVc4iapHj4azThHK-L03i-t3TiIIMS5Jv2QfnrgazKVpkJ48zw5jKJPzcvk4eCUtRmWdcWrYpJnshAVrO1hZXzDbV39gNeNlARqSmtto34K5-ppaY8Msui-62A&lib=MvGSsCthjbGW7s5xhObuf00FNOc6D1c8x";
let DATA=[];

fetch(API_URL)
  .then(r=>r.json())
  .then(d=>{DATA=d;initStudents();});

function initStudents(){
  const sel=document.getElementById("studentSelect");
  [...new Set(DATA.map(r=>r.Student))].forEach(s=>{
    sel.add(new Option(s,s));
  });
  sel.onchange=()=>render(sel.value);
}

function render(student){
  const rows=DATA.filter(r=>r.Student===student);
  renderDays(rows);
  renderTrackers(rows);
}

function renderDays(rows){
  const today=new Date();today.setHours(0,0,0,0);
  const map={Yesterday:[],Today:[],Tomorrow:[]};

  rows.forEach(r=>{
    if(!r.ExpectedDate) return;
    const d=new Date(r.ExpectedDate);d.setHours(0,0,0,0);
    const diff=(d-today)/(86400000);
    if(diff===-1) map.Yesterday.push(r);
    if(diff===0) map.Today.push(r);
    if(diff===1) map.Tomorrow.push(r);
  });

  const box=document.getElementById("days");
  box.innerHTML="";
  Object.entries(map).forEach(([k,v])=>{
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`<h3>${k}</h3>`;
    v.forEach(x=>{
      c.innerHTML+=`
      <div class="chapter">
        <div class="subject">${x.Subject}</div>
        <div>${x.Title}</div>
        <span class="status ${x.Status}">${x.Status}</span>
      </div>`;
    });
    box.appendChild(c);
  });
}

function renderTrackers(rows){
  const box=document.getElementById("trackers");
  box.innerHTML="";
  [...new Set(rows.map(r=>r.Subject))].forEach(s=>{
    const total=rows.filter(r=>r.Subject===s).length;
    const done=rows.filter(r=>r.Subject===s&&r.Status==="completed").length;
    const pct=Math.round((done/total)*100)||0;

    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`
      <div class="gauge">
        <svg viewBox="0 0 180 100">
          <path d="M10 90 A80 80 0 0 1 170 90" class="bg"/>
          <path d="M10 90 A80 80 0 0 1 170 90" class="progress"/>
        </svg>
        <div class="percent">${pct}%</div>
      </div>
      <h4 style="text-align:center;font-family:Montserrat">${s}</h4>`;
    box.appendChild(c);

    c.querySelector(".progress").style.strokeDashoffset=251*(1-pct/100);
  });
}
</script>

</body>
</html>
