<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sehr Academy — Academic Calendar (May 2025 – Apr 2026)</title>
  <meta name="theme-color" content="#8BC53F" />
  <meta name="description" content="Sehr Academy — Academic Calendar (May 2025 – Apr 2026). Frosty-glass design with month navigation. Powered by a single JSON file." />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800;900&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --sehr-green:#8BC53F;
      --ink:#0F172A; --ink-soft:#152036; --muted:#5b6475;
      --frost:#ffffff; --frost-tint:#f7f9fb; --glass-edge:#e6e8ec; --shadow:0 10px 30px rgba(15,23,42,.06);
      --evening-a: rgba(139,197,63,.14); --evening-b: rgba(139,197,63,.06);
      --phys-a:#4e8ef7; --phys-b:#8bb4ff;
      --chem-a:#54c15a; --chem-b:#94e09b;
      --math-a:#f35c5c; --math-b:#ff9a9a;
      --bio-a:#ffd84e;  --bio-b:#fff19e;
      --pill-br:#dfe4ea;

      /* Gold palette for teacher pill */
      --gold-a:#fbe9a7;   /* highlight */
      --gold-b:#f3c96a;   /* mid */
      --gold-c:#e3b23c;   /* deep */
      --gold-br:#e8d7a6;  /* border */
      --gold-glow:rgba(227,178,60,.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Nunito",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--ink); background:#fff;
      background-image:
        radial-gradient(60rem 60rem at -10% -10%, rgba(139,197,63,.08), transparent 55%),
        radial-gradient(60rem 60rem at 110% 10%, rgba(139,197,63,.06), transparent 50%),
        linear-gradient(180deg, #fff, #fff);
      background-attachment: fixed,fixed,fixed;
    }
    header{position:sticky;top:0;z-index:30;background:rgba(255,255,255,.78);backdrop-filter:saturate(175%) blur(10px);border-bottom:1px solid rgba(230,232,236,.6)}
    .wrap{max-width:1200px;margin:0 auto;padding:12px 20px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:baseline;gap:10px;text-decoration:none}
    .brand span:nth-child(1){font-family:"Montserrat",sans-serif;font-weight:900;font-size:22px;color:var(--sehr-green)}
    .brand span:nth-child(2){font-family:"Montserrat",sans-serif;font-weight:900;font-size:22px;color:#0b0f10}

    /* Controls */
    .controls{display:flex;align-items:center;gap:10px}
    .btn{
      appearance:none;border:1px solid var(--glass-edge);background:#fff;border-radius:10px;padding:8px 12px;
      font-weight:800;letter-spacing:.2px;cursor:pointer;box-shadow:var(--shadow)
    }
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .select{
      appearance:none;border:1px solid var(--glass-edge);background:#fff;border-radius:10px;padding:8px 12px;
      font-weight:800;letter-spacing:.2px;box-shadow:var(--shadow);min-width:220px
    }
    .select.small{min-width:180px}

    /* Page heading */
    .heading{display:flex;align-items:center;justify-content:space-between;gap:16px;max-width:1200px;margin:18px auto 8px;padding:0 20px}
    .title{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    .title h1{margin:0;font-family:"Montserrat",sans-serif;font-weight:800;font-size:22px;letter-spacing:.2px}
    .badge{font-size:12px;font-weight:700;color:#0b0f10;background:#fff;border:1px solid var(--glass-edge);padding:4px 10px;border-radius:999px;line-height:1.1}

    /* Filters row (right of title) */
    .filters{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .filters .label{font-size:12px;color:var(--muted);font-weight:800}
    .filters .clear{display:none}

    .calendar{max-width:1200px;margin:0 auto 72px;padding:10px 20px 40px;display:grid;grid-template-rows:auto 1fr;gap:10px}
    .weekdays{display:grid;grid-template-columns:repeat(7,1fr);gap:10px;color:var(--muted);font-weight:800;font-size:12px;text-transform:uppercase;letter-spacing:.6px}
    .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:10px;align-items:start}

    .day{background:linear-gradient(180deg, var(--frost), var(--frost-tint));border:1px solid var(--glass-edge);border-radius:14px;box-shadow:var(--shadow);padding:12px;display:flex;flex-direction:column;gap:10px}
    .day.dim{opacity:.5}
    .day-header{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .date{font-family:"Montserrat",sans-serif;font-weight:800;font-size:18px;color:#0b0f10;letter-spacing:.2px;line-height:1}
    .weekday{font-size:12px;color:var(--muted);font-weight:800;line-height:1}
    .accent{height:3px;width:100%;background:linear-gradient(90deg,#e9f1e6,var(--sehr-green),#e9f1e6);border-radius:999px;opacity:.45;flex:none}
    .events{display:flex;flex-direction:column;gap:8px;margin-top:1px}

    .event{
      position:relative;
      border-radius:12px;
      padding:10px 12px;
      backdrop-filter: blur(6px) saturate(120%);
      transition:transform .15s ease, box-shadow .15s ease;
      will-change:transform;
      border:1px solid var(--glass-edge);
      box-shadow:0 10px 24px rgba(15,23,42,.06), inset 0 1px 0 rgba(255,255,255,.5);
      overflow:hidden; /* keep bg contained */
    }
    .event::before{
      content:"";
      position:absolute; left:0; top:0; bottom:0; width:5px;
      border-radius:12px 0 0 12px; opacity:.9; z-index:2; /* keep accent bar above bg */
    }
    /* Subject background image layer */
    .event::after{
      content:"";
      position:absolute; inset:0; z-index:0; pointer-events:none;
      background-size:cover; background-position:center;
      /* Darken + unify for readability */
      background-image:none; /* set per-subject below */
      filter:contrast(1.05) saturate(1.05) brightness(.45);
      opacity:.9;
      mix-blend-mode:multiply;
    }
    /* keep the text above images */
    .event > *{ position:relative; z-index:1 }

    .event.morning{background:linear-gradient(180deg, rgba(255,255,255,.96), rgba(241,245,255,.92));border-color:#dde6f6;box-shadow:0 10px 24px rgba(78,142,247,.08), inset 0 1px 0 rgba(255,255,255,.6)}
    .event.morning::before{ background:linear-gradient(180deg,#8bb4ff,#4e8ef7) }
    .event.evening{background:linear-gradient(180deg, rgba(235,250,236,.96), rgba(220,245,224,.90)), radial-gradient(120% 120% at 100% -10%, var(--evening-a), var(--evening-b));border-color:#cfe9d1;box-shadow:0 10px 24px rgba(84,193,90,.10), inset 0 1px 0 rgba(255,255,255,.6)}
    .event.evening::before{ background:linear-gradient(180deg,#94e09b,#54c15a) }

    /* Live event style */
    .event.live{
      background: linear-gradient(180deg, rgba(255,230,230,.96), rgba(255,205,205,.92));
      border-color: #f7b0b0;
      box-shadow: 0 10px 24px rgba(243,92,92,.12), inset 0 1px 0 rgba(255,255,255,.6);
    }
    .event.live::before{
      background: linear-gradient(180deg, #ff6b6b, #f35c5c);
    }

    .event:hover{transform:translateY(-1px);box-shadow:0 14px 30px rgba(15,23,42,.12), inset 0 1px 0 rgba(255,255,255,.6)}
    .event-title{margin:0 0 6px;font-family:"Montserrat",sans-serif;font-weight:800;font-size:15px;line-height:1.25;color:var(--ink-soft);letter-spacing:.2px}
    .event-meta{display:flex;flex-wrap:wrap;gap:8px;align-items:center;font-size:12px;color:#0b0f10}
    .pill{display:inline-flex;align-items:center;gap:6px;border-radius:8px;padding:6px 10px;background:#fff;border:1px solid var(--pill-br);font-weight:800;line-height:1.05}
    .pill.time{background:linear-gradient(180deg,#ffffff,#f4f7fa);border-color:#dfe6ee;text-transform:uppercase}
    .pill.subject{color:#0b0f10;border:none}
    .pill.subject.physics{background-image:linear-gradient(180deg,var(--phys-b),var(--phys-a));box-shadow:inset 0 1px 0 rgba(255,255,255,.6), 0 2px 10px rgba(78,142,247,.22)}
    .pill.subject.chemistry{background-image:linear-gradient(180deg,var(--chem-b),var(--chem-a));box-shadow:inset 0 1px 0 rgba(255,255,255,.6), 0 2px 10px rgba(84,193,90,.22)}
    .pill.subject.maths{background-image:linear-gradient(180deg,var(--math-b),var(--math-a));box-shadow:inset 0 1px 0 rgba(255,255,255,.6), 0 2px 10px rgba(243,92,92,.22)}
    .pill.subject.biology{background-image:linear-gradient(180deg,var(--bio-b),var(--bio-a));box-shadow:inset 0 1px 0 rgba(255,255,255,.6), 0 2px 10px rgba(255,216,78,.22)}
    .pill.note{background:linear-gradient(180deg,#ffffff,#f7f9ff);border:1px solid #e5e9f9}

    /* GOLD teacher pill (name only) */
    .pill.teacher{
      background-image:
        linear-gradient(180deg, var(--gold-a), var(--gold-b));
      border:1px solid var(--gold-br);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.55),
        0 2px 10px var(--gold-glow);
      color:#3a2d07;
      font-weight:800;
    }

    /* SUBJECT IMAGE MAPPINGS (darkened via ::after) */
    .event.bg-physics::after{
      background-image:
        linear-gradient(0deg, rgba(0,0,0,.55), rgba(0,0,0,.55)),
        url("https://i.postimg.cc/rmDJ6TZj/Chat-GPT-Image-Sep-11-2025-11-23-35-AM.png");
    }
    .event.bg-chemistry::after{
      background-image:
        linear-gradient(0deg, rgba(0,0,0,.55), rgba(0,0,0,.55)),
        url("https://i.postimg.cc/Ls6DTLzr/3.png");
    }
    .event.bg-maths::after{
      background-image:
        linear-gradient(0deg, rgba(0,0,0,.55), rgba(0,0,0,.55)),
        url("https://i.postimg.cc/pdGZ1rCy/4.png");
    }
    .event.bg-biology::after{
      background-image:
        linear-gradient(0deg, rgba(0,0,0,.55), rgba(0,0,0,.55)),
        url("https://i.postimg.cc/jShvPZJH/2.png");
    }

    @media (max-width:1100px){
      .heading{align-items:flex-start;gap:12px}
      .title{flex:1 1 auto}
      .filters{width:100%}
    }
    @media (max-width:900px){.event-title{font-size:14px}}
    @media (max-width:700px){.weekdays{display:none}.grid{gap:8px}.day{padding:10px;border-radius:12px}.date{font-size:18px}}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <a class="brand" href="https://www.sehracademy.com/" aria-label="Sehr Academy"><span>SEHR</span><span>ACADEMY</span></a>
      <div class="controls">
        <button id="prev" class="btn" title="Previous Month">◀ Prev</button>
        <select id="monthSelect" class="select" aria-label="Select month"></select>
        <button id="next" class="btn" title="Next Month">Next ▶</button>
      </div>
    </div>
  </header>

  <div class="heading">
    <div class="title">
      <h1 id="page-title">Academic Calendar — May 2025 to Apr 2026</h1>
      <span id="badge" class="badge" style="display:none"></span>
    </div>
    <!-- Filters live here (to the right of the title on wide screens) -->
    <div class="filters" aria-label="Filters" role="group">
      <span class="label" aria-hidden="true">Filter:</span>
      <select id="subjectFilter" class="select small" aria-label="Filter by subject">
        <option value="">All Subjects</option>
      </select>
      <select id="teacherFilter" class="select small" aria-label="Filter by teacher">
        <option value="">All Teachers</option>
      </select>
      <button id="clearFilters" class="btn clear" title="Clear filters">✕ Clear</button>
    </div>
  </div>

  <main id="calendar" class="calendar" data-json="data/academic-2025-2026.json">
    <div class="weekdays" role="row" aria-hidden="true">
      <div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div><div>Sun</div>
    </div>
    <div id="calendar-grid" class="grid" aria-live="polite"></div>
  </main>

  <script>
    const qs = new URLSearchParams(location.search);
    const dataParam = qs.get('data'); // override JSON path
    const monthParam = qs.get('month'); // yyyy-mm to start on (optional)
    const calendarEl = document.getElementById('calendar');
    const jsonPath = dataParam || calendarEl.dataset.json || 'data/academic-2025-2026.json';

    const MONTHS = ["January","February","March","April","May","June","July","August","September","October","November","December"];
    const wd = n => ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"][n];
    const toMonIndex = jsDay => (jsDay + 6) % 7; // Mon=0 … Sun=6

    const isMorning = t => /MORNING/i.test(t || '');
    const isEvening = t => /EVENING/i.test(t || '');
    function subjectClass(subj=""){
      const s = String(subj).trim().toLowerCase();
      if (/physics/.test(s)) return 'physics';
      if (/chem/.test(s))   return 'chemistry';
      if (/math/.test(s))   return 'maths';
      if (/botany|zoology|biology/.test(s)) return 'biology';
      return '';
    }
    const stripBrackets = (txt='') => String(txt).replace(/\[|\]/g,'').trim();
    const compactTime   = (txt='') => String(txt)
      .replace(/:00\s*(AM|PM)/i,' $1')
      .replace(/\bAM\b/i,'AM')
      .replace(/\bPM\b/i,'PM')
      .replace(/MORNING\s*(\d+)\s*AM/i,'MORNING $1 AM')
      .replace(/EVENING\s*(\d+)\s*PM/i,'EVENING $1 PM');

    // Global state
    let RAW_DATA = null;
    let CURRENT_YM = null;
    const FILTERS = { subject: '', teacher: '' }; // empty = no filter

    async function loadJSON(path){
      const res = await fetch(path, {cache:'no-store'});
      if(!res.ok) throw new Error('Failed to load '+path+' — '+res.status);
      return res.json();
    }

    function clampAcademic(date, start, end){
      if (date < start) return new Date(start);
      if (date > end) return new Date(end);
      return date;
    }

    function makeMonthOptions(start, end){
      const opts = [];
      const cur = new Date(start);
      cur.setDate(1);
      while (cur <= end){
        opts.push({value:cur.toISOString().slice(0,7), label: MONTHS[cur.getMonth()]+' '+cur.getFullYear()});
        cur.setMonth(cur.getMonth()+1);
      }
      return opts;
    }

    function renderControls(start, end, currentYM){
      const sel = document.getElementById('monthSelect');
      sel.innerHTML = '';
      makeMonthOptions(start, end).forEach(opt => {
        const o = document.createElement('option');
        o.value = opt.value; o.textContent = opt.label;
        if (opt.value === currentYM) o.selected = true;
        sel.appendChild(o);
      });
      const prevBtn = document.getElementById('prev');
      const nextBtn = document.getElementById('next');
      prevBtn.disabled = currentYM === sel.options[0].value;
      nextBtn.disabled = currentYM === sel.options[sel.options.length-1].value;

      prevBtn.onclick = ()=>{
        const i = sel.selectedIndex;
        if (i>0){ sel.selectedIndex = i-1; sel.dispatchEvent(new Event('change')); }
      };
      nextBtn.onclick = ()=>{
        const i = sel.selectedIndex;
        if (i<sel.options.length-1){ sel.selectedIndex = i+1; sel.dispatchEvent(new Event('change')); }
      };
    }

    function filterEvents(events){
      const subj = FILTERS.subject.trim().toLowerCase();
      const teach = FILTERS.teacher.trim().toLowerCase();
      if (!subj && !teach) return events;
      return events.filter(e => {
        const eSubj = stripBrackets(e.subject || '').toLowerCase();
        const eTeach = stripBrackets(e.teacher || '').toLowerCase();
        const okSubj = subj ? eSubj === subj : true;
        const okTeach = teach ? eTeach === teach : true;
        return okSubj && okTeach;
      });
    }

    function updateFilterBadge(){
      const badge = document.getElementById('badge');
      const clearBtn = document.getElementById('clearFilters');
      const parts = [];
      if (FILTERS.subject) parts.push(`Subject: ${FILTERS.subject}`);
      if (FILTERS.teacher) parts.push(`Teacher: ${FILTERS.teacher}`);
      if (parts.length){
        badge.textContent = 'Filters — ' + parts.join(' · ');
        badge.style.display='';
        clearBtn.style.display='inline-block';
      } else {
        badge.style.display='none';
        clearBtn.style.display='none';
      }
    }

    function renderCalendar(meta, allEvents, ym){
      CURRENT_YM = ym; // persist current view
      const [y, m] = ym.split('-').map(Number);
      const year = y, monthIndex = m-1;
      document.title = meta.pageTitle || `Sehr Academy — Academic Calendar (${MONTHS[monthIndex]} ${year})`;
      document.getElementById('page-title').textContent = meta.title || `Academic Calendar — ${MONTHS[monthIndex]} ${year}`;
      updateFilterBadge();

      const grid = document.getElementById('calendar-grid');
      grid.innerHTML = '';

      const first = new Date(year, monthIndex, 1);
      const last  = new Date(year, monthIndex + 1, 0);
      const daysInMonth = last.getDate();
      const leadingBlanks = toMonIndex(first.getDay());
      const totalCells = leadingBlanks + daysInMonth;
      const trailingBlanks = (7 - (totalCells % 7)) % 7;

      // APPLY FILTERS
      const events = filterEvents(allEvents || []);

      const byDay = {};
      for (const e of events){
        const d = new Date(e.date);
        if (d.getMonth() !== monthIndex || d.getFullYear() !== year) continue;
        const day = d.getDate();
        (byDay[day] ||= []).push(e);
      }

      const frag = document.createDocumentFragment();
      const mkEmpty = () => {
        const c = document.createElement('div');
        c.className = 'day dim';
        c.innerHTML = `
          <div class="day-header"><span class="date">&nbsp;</span><span class="weekday">&nbsp;</span></div>
          <div class="accent" style="opacity:.2"></div>
          <div class="events"></div>`;
        return c;
      };
      for (let i=0;i<leadingBlanks;i++) frag.appendChild(mkEmpty());

      const weekdayName = n => ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"][n];

      for (let dateNum=1; dateNum<=daysInMonth; dateNum++){
        const dowMonIdx = (leadingBlanks + (dateNum-1)) % 7;
        const c = document.createElement('div');
        c.className = 'day';
        c.innerHTML = `
          <div class="day-header">
            <span class="date">${dateNum}</span>
            <span class="weekday">${weekdayName(dowMonIdx)}</span>
          </div>
          <div class="accent"></div>
          <div class="events"></div>`;

        const evWrap = c.querySelector('.events');
        const todays = (byDay[dateNum] || []);

        const sundayRow = todays.find(e => e.sunday);
        if (sundayRow){
          const eDiv = document.createElement('div');
          eDiv.className = 'event morning';
          eDiv.innerHTML = `
            <p class="event-title">No Classes — Sunday</p>
            <div class="event-meta">
              <span class="pill note"><strong>Sunday</strong></span>
            </div>`;
          evWrap.appendChild(eDiv);
        }

        todays.filter(e => !e.sunday).forEach(e => {
          const eDiv = document.createElement('div');

          // Determine time styling
          const timeClass = isMorning(e.time) ? 'morning' : (isEvening(e.time) ? 'evening' : 'morning');

          // Subject class & cleaned fields
          const subjClass = subjectClass(e.subject);
          const cleanSubject = stripBrackets(e.subject);
          const cleanTopic   = stripBrackets(e.topic || '—');
          const timeText     = compactTime(e.time || '');
          const teacherName  = stripBrackets(e.teacher || '');   // read from JSON
          const showExamPill = meta.showExamPill !== false; // default true

          // Detect LIVE topics ("LIVE - ...")
          const isLive = /^LIVE\s*- /i.test(cleanTopic) || /^LIVE\s*-/i.test(cleanTopic);

          // Build classes (include per-subject bg class)
          eDiv.className = `event ${timeClass}${isLive ? ' live' : ''} ${subjClass ? ('bg-' + subjClass) : ''}`;

          eDiv.innerHTML = `
            <p class="event-title">${cleanTopic}</p>
            <div class="event-meta">
              ${timeText ? `<span class="pill time"><strong>${timeText}</strong></span>` : ''}
              ${cleanSubject ? `<span class="pill subject ${subjClass}"><strong>${e.exam ? (showExamPill ? 'Exam' : cleanSubject) : cleanSubject}</strong></span>` : ''}
              ${teacherName ? `<span class="pill teacher">${teacherName}</span>` : ''}
            </div>`;
          evWrap.appendChild(eDiv);
        });

        frag.appendChild(c);
      }
      for (let i=0;i<trailingBlanks;i++) frag.appendChild(mkEmpty());
      grid.appendChild(frag);
    }

    function populateFiltersFromData(allEvents){
      const subjects = Array.from(new Set((allEvents||[]).map(e => stripBrackets(e.subject||'')).filter(Boolean))).sort((a,b)=>a.localeCompare(b));
      const teachers = Array.from(new Set((allEvents||[]).map(e => stripBrackets(e.teacher||'')).filter(Boolean))).sort((a,b)=>a.localeCompare(b));

      const subjSel = document.getElementById('subjectFilter');
      const teachSel = document.getElementById('teacherFilter');

      // Clear existing (keep first option = All ...)
      subjSel.length = 1; // keep index 0
      teachSel.length = 1;

      subjects.forEach(s => {
        const o = document.createElement('option');
        o.value = s; o.textContent = s; subjSel.appendChild(o);
      });
      teachers.forEach(t => {
        const o = document.createElement('option');
        o.value = t; o.textContent = t; teachSel.appendChild(o);
      });
    }

    (async function init(){
      try{
        const data = await loadJSON(jsonPath);
        RAW_DATA = data; // store
        const start = new Date(data.meta.start);
        const end   = new Date(data.meta.end);
        if (Number.isNaN(start) || Number.isNaN(end)) throw new Error('Invalid start/end in meta');

        // Populate filters from JSON once
        populateFiltersFromData(data.events || []);

        // Wire filter handlers
        const subjSel = document.getElementById('subjectFilter');
        const teachSel = document.getElementById('teacherFilter');
        const clearBtn = document.getElementById('clearFilters');

        function applyFiltersAndRender(){
          const ym = document.getElementById('monthSelect').value || CURRENT_YM;
          const perMonthMeta = (RAW_DATA.monthMeta && RAW_DATA.monthMeta[ym]) || {};
          const meta = { ...RAW_DATA.meta, ...perMonthMeta };
          renderCalendar(meta, RAW_DATA.events || [], ym);
          renderControls(start, end, ym);
        }

        subjSel.onchange = ()=>{ FILTERS.subject = subjSel.value || ''; updateFilterBadge(); applyFiltersAndRender(); };
        teachSel.onchange = ()=>{ FILTERS.teacher = teachSel.value || ''; updateFilterBadge(); applyFiltersAndRender(); };
        clearBtn.onclick = ()=>{
          FILTERS.subject = '';
          FILTERS.teacher = '';
          subjSel.value = '';
          teachSel.value = '';
          updateFilterBadge();
          applyFiltersAndRender();
        };

        const initial = (()=>{
          if (monthParam) {
            const [yy, mm] = monthParam.split('-').map(Number);
            const proposed = new Date(yy, (mm||1)-1, 1);
            return clampAcademic(proposed, start, end);
          }
          const now = new Date();                 // always use today
          return clampAcademic(now, start, end);  // clamp to your calendar range
        })();

        function renderMonthControls(start, end, currentYM){
          const sel = document.getElementById('monthSelect');
          sel.innerHTML = '';
          const cur = new Date(start); cur.setDate(1);
          while (cur <= end){
            const ym = cur.toISOString().slice(0,7);
            const label = MONTHS[cur.getMonth()]+' '+cur.getFullYear();
            const o = document.createElement('option');
            o.value = ym; o.textContent = label;
            if (ym === currentYM) o.selected = true;
            sel.appendChild(o);
            cur.setMonth(cur.getMonth()+1);
          }
          const prevBtn = document.getElementById('prev');
          const nextBtn = document.getElementById('next');
          prevBtn.disabled = currentYM === sel.options[0].value;
          nextBtn.disabled = currentYM === sel.options[sel.options.length-1].value;
          prevBtn.onclick = ()=>{ const i = sel.selectedIndex; if (i>0){ sel.selectedIndex = i-1; sel.dispatchEvent(new Event('change')); } };
          nextBtn.onclick = ()=>{ const i = sel.selectedIndex; if (i<sel.options.length-1){ sel.selectedIndex = i+1; sel.dispatchEvent(new Event('change')); } };
        }

        const sel = document.getElementById('monthSelect');
        const applyMonth = () => {
          const ym = sel.value;
          const perMonthMeta = (data.monthMeta && data.monthMeta[ym]) || {};
          const meta = { ...data.meta, ...perMonthMeta };
          renderCalendar(meta, data.events || [], ym);
          renderControls(start, end, ym);
        };
        sel.onchange = applyMonth;

        // First render
        const initialYM = initial.toISOString().slice(0,7);
        renderControls(start, end, initialYM);
        const idx = Array.from(sel.options).findIndex(o => o.value === initialYM);
        if (idx >= 0) sel.selectedIndex = idx;
        applyMonth();

      }catch(err){
        console.error(err);
        document.getElementById('calendar-grid').innerHTML = '<p style="color:#c00;font-weight:700">Failed to load academic calendar data. Check the JSON path or ?data=... query.</p>';
      }
    })();
  </script>
</body>
</html>
